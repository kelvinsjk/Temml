var temml=function(){"use strict";class e{constructor(t,r){let n,o=" "+t;const s=r&&r.loc;if(s&&s.start<=s.end){const e=s.lexer.input;n=s.start;const t=s.end;n===e.length?o+=" at end of input: ":o+=" at position "+(n+1)+": ";const r=e.slice(n,t).replace(/[^]/g,"$&̲");let a,i;a=n>15?"…"+e.slice(n-15,n):e.slice(0,n),i=t+15<e.length?e.slice(t,t+15)+"…":e.slice(t),o+=a+r+i}const a=new Error(o);return a.name="TemmlParseError",a.__proto__=e.prototype,a.position=n,a}}e.prototype.__proto__=Error.prototype;const t=/([A-Z])/g,r={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},n=/[&><"']/g;const o=function(e){return"ordgroup"===e.type||"color"===e.type?1===e.body.length?o(e.body[0]):e:"font"===e.type?o(e.body):e};var s={contains:function(e,t){return-1!==e.indexOf(t)},deflt:function(e,t){return void 0===e?t:e},escape:function(e){return String(e).replace(n,(e=>r[e]))},hyphenate:function(e){return e.replace(t,"-$1").toLowerCase()},getBaseElem:o,isCharacterBox:function(e){const t=o(e);return"mathord"===t.type||"textord"===t.type||"atom"===t.type},protocolFromUrl:function(e){const t=/^\s*([^\\/#]*?)(?::|&#0*58|&#x0*3a)/i.exec(e);return null!=t?t[1]:"_relative"},round:function(e){return+e.toFixed(4)}};class a{constructor(e){e=e||{},this.displayMode=s.deflt(e.displayMode,!1),this.leqno=s.deflt(e.leqno,!1),this.errorColor=s.deflt(e.errorColor,"#b22222"),this.macros=e.macros||{},this.colorIsTextColor=s.deflt(e.colorIsTextColor,!1),this.strict=s.deflt(e.strict,!1),this.trust=s.deflt(e.trust,!1),this.maxSize=Math.max(0,s.deflt(e.maxSize,1/0)),this.maxExpand=Math.max(0,s.deflt(e.maxExpand,1e3))}reportNonstrict(t,r,n){const o=this.strict;if(!1!==o&&!0===o)throw new e(`LaTeX-incompatible input and strict mode is set to 'error': ${r} [${t}]`,n)}isTrusted(e){e.url&&!e.protocol&&(e.protocol=s.protocolFromUrl(e.url));const t="function"==typeof this.trust?this.trust(e):this.trust;return Boolean(t)}}const i={},l={};function c({type:e,names:t,props:r,handler:n,mathmlBuilder:o}){const s={type:e,numArgs:r.numArgs,argTypes:r.argTypes,allowedInArgument:!!r.allowedInArgument,allowedInText:!!r.allowedInText,allowedInMath:void 0===r.allowedInMath||r.allowedInMath,numOptionalArgs:r.numOptionalArgs||0,infix:!!r.infix,primitive:!!r.primitive,handler:n};for(let e=0;e<t.length;++e)i[t[e]]=s;e&&o&&(l[e]=o)}function p({type:e,mathmlBuilder:t}){c({type:e,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},mathmlBuilder:t})}const m=function(e){return"ordgroup"===e.type&&1===e.body.length?e.body[0]:e},u=function(e){return"ordgroup"===e.type?e.body:[e]};class d{constructor(e){this.children=e,this.classes=[],this.style={}}hasClass(e){return s.contains(this.classes,e)}toNode(){const e=document.createDocumentFragment();for(let t=0;t<this.children.length;t++)e.appendChild(this.children[t].toNode());return e}toMarkup(){let e="";for(let t=0;t<this.children.length;t++)e+=this.children[t].toMarkup();return e}toText(){return this.children.map((e=>e.toText())).join("")}}const h=function(e){return e.filter((e=>e)).join(" ")},g=function(e,t){this.classes=e||[],this.attributes={},this.style=t||{}},b=function(e){const t=document.createElement(e);t.className=h(this.classes);for(const e in this.style)Object.prototype.hasOwnProperty.call(this.style,e)&&(t.style[e]=this.style[e]);for(const e in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,e)&&t.setAttribute(e,this.attributes[e]);for(let e=0;e<this.children.length;e++)t.appendChild(this.children[e].toNode());return t},f=function(e){let t=`<${e}`;"svg"===e&&(t+=' xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"'),this.classes.length&&(t+=` class="${s.escape(h(this.classes))}"`);let r="";for(const e in this.style)Object.prototype.hasOwnProperty.call(this.style,e)&&(r+=`${s.hyphenate(e)}:${this.style[e]};`);r&&(t+=` style="${s.escape(r)}"`);for(const e in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,e)&&(t+=` ${e}="${s.escape(this.attributes[e])}"`);t+=">";for(let e=0;e<this.children.length;e++)t+=this.children[e].toMarkup();return t+=`</${e}>`,t};class y{constructor(e,t){g.call(this,e),this.children=t||[]}setAttribute(e,t){this.attributes[e]=t}toNode(){return b.call(this,"span")}toMarkup(){return f.call(this,"span")}}class w{constructor(e){this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return s.escape(this.text)}}class x{constructor(e,t,r){this.alt=t,this.src=e,this.classes=["mord"],this.style=r}hasClass(e){return s.contains(this.classes,e)}toNode(){const e=document.createElement("img");e.src=this.src,e.alt=this.alt,e.className="mord";for(const t in this.style)Object.prototype.hasOwnProperty.call(this.style,t)&&(e.style[t]=this.style[t]);return e}toMarkup(){let e=`<img  src='${this.src} 'alt='${this.alt}' `,t="";for(const e in this.style)Object.prototype.hasOwnProperty.call(this.style,e)&&(t+=`${s.hyphenate(e)}:${this.style[e]};`);return t&&(e+=` style="${s.escape(t)}"`),e+="'/>",e}}function k(e){return new d(e)}class A{constructor(e,t,r,n){this.type=e,this.attributes={},this.children=t||[],this.classes=r||[],this.isSVG=n||!1}setAttribute(e,t){this.attributes[e]=t}getAttribute(e){return this.attributes[e]}toNode(){const e=this.isSVG?document.createElementNS("http://www.w3.org/2000/svg",this.type):document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(const t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);this.classes.length>0&&(e.className=h(this.classes));for(let t=0;t<this.children.length;t++)e.appendChild(this.children[t].toNode());return e}toMarkup(){let e="<"+this.type;for(const t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="',e+=s.escape(this.attributes[t]),e+='"');this.classes.length>0&&(e+=` class ="${s.escape(h(this.classes))}"`),e+=">";for(let t=0;t<this.children.length;t++)e+=this.children[t].toMarkup();return e+="</"+this.type+">",e}toText(){return this.children.map((e=>e.toText())).join("")}}class v{constructor(e){this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return s.escape(this.toText())}toText(){return this.text}}var N={MathNode:A,TextNode:v,newDocumentFragment:k};const T=["longRightleftharpoons","longLeftrightharpoons"],q={widehat:"^",widecheck:"ˇ",widetilde:"~",wideparen:"⏜",utilde:"~",overleftarrow:"←",underleftarrow:"←",xleftarrow:"←",overrightarrow:"→",underrightarrow:"→",xrightarrow:"→",underbrace:"⏟",overbrace:"⏞",overgroup:"⏠",overparen:"⏜",undergroup:"⏡",underparen:"⏝",overleftrightarrow:"↔",underleftrightarrow:"↔",xleftrightarrow:"↔",Overrightarrow:"⇒",xRightarrow:"⇒",overleftharpoon:"↼",xleftharpoonup:"↼",overrightharpoon:"⇀",xrightharpoonup:"⇀",xLeftarrow:"⇐",xLeftrightarrow:"⇔",xhookleftarrow:"↩",xhookrightarrow:"↪",xmapsto:"↦",xrightharpoondown:"⇁",xleftharpoondown:"↽",xrightleftharpoons:"⇌",xleftrightharpoons:"⇋",xtwoheadleftarrow:"↞",xtwoheadrightarrow:"↠",xlongequal:"=",xtofrom:"⇄",xrightleftarrows:"⇄",longleftrightarrows:"⇄",longrightleftharpoons:"⇌","\\cdrightarrow":"→","\\cdleftarrow":"←","\\cdlongequal":"="},S={longRightleftharpoons:{minWidth:1.75,height:.716},longLeftrightharpoons:{minWidth:1.75,height:.716}},M=(e,t,r)=>(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("width","400em"),e.setAttribute("height",S[t].height+"em"),e.setAttribute("viewBox","0 0 400000 "+1e3*S[t].height),e.setAttribute("preserveAspectRatio",r),e.setAttribute("fill","currentColor"),e.setAttribute("fill-rule","non-zero"),e.setAttribute("fill-opacity","1"),e);var B=function(e,t){const r=e.slice(1),n=s.contains(T,r)?((e,t)=>{const r=new N.MathNode("path",[],[],!0);r.setAttribute("stroke","none");const n=t.get(e+"Left");r.setAttribute("d",n);const o=new N.MathNode("path",[],[],!0);o.setAttribute("stroke","none");const s=t.get(e+"Right");o.setAttribute("d",s);let a=new N.MathNode("svg",[r],[],!0);a=M(a,e,"xMinYMin slice"),a.setAttribute("style","position: absolute; left:0;");let i=new N.MathNode("svg",[o],[],!0);i=M(i,e,"xMaxYMin slice"),i.setAttribute("style","position: absolute; right:0");const l=S[e].height,c=new y([],[a]);c.setAttribute("style",`position: absolute; left: 0; width: 50.2%; height: ${l}em; overflow: hidden;`);const p=new y([],[i]);p.setAttribute("style",`position: absolute; right: 0; width: 50.2%; height: ${l}em; overflow: hidden;`);const m=new y(["stretchy"],[c,p]);return m.setAttribute("style",`display: block; position: relative; width: 100%; height: ${l}em;\nmin-width: ${S[e].minWidth}em;`),m})(r,t):new N.TextNode(q[r]),o=new N.MathNode("mo",[n]);return o.setAttribute("stretchy","true"),o};const O={bin:1,close:1,inner:1,open:1,punct:1,rel:1},C={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},E={math:{},text:{}};function I(e,t,r,n,o){E[e][n]={group:t,replace:r},o&&r&&(E[e][r]=E[e][n])}const z="math",$="text",L="accent-token",D="bin",F="close",G="inner",U="mathord",P="op-token",j="open",R="punct",_="rel",V="spacing",W="textord";I(z,_,"≡","\\equiv",!0),I(z,_,"≺","\\prec",!0),I(z,_,"≻","\\succ",!0),I(z,_,"∼","\\sim",!0),I(z,_,"⟂","\\perp",!0),I(z,_,"⪯","\\preceq",!0),I(z,_,"⪰","\\succeq",!0),I(z,_,"≃","\\simeq",!0),I(z,_,"|","\\mid",!0),I(z,_,"≪","\\ll",!0),I(z,_,"≫","\\gg",!0),I(z,_,"≍","\\asymp",!0),I(z,_,"∥","\\parallel"),I(z,_,"⋈","\\bowtie",!0),I(z,_,"⌣","\\smile",!0),I(z,_,"⊑","\\sqsubseteq",!0),I(z,_,"⊒","\\sqsupseteq",!0),I(z,_,"≐","\\doteq",!0),I(z,_,"⌢","\\frown",!0),I(z,_,"∋","\\ni",!0),I(z,_,"∌","\\notni",!0),I(z,_,"∝","\\propto",!0),I(z,_,"⊢","\\vdash",!0),I(z,_,"⊣","\\dashv",!0),I(z,_,"∋","\\owns"),I(z,_,"≘","\\arceq",!0),I(z,_,"≙","\\wedgeq",!0),I(z,_,"≚","\\veeeq",!0),I(z,_,"≛","\\stareq",!0),I(z,_,"≝","\\eqdef",!0),I(z,_,"≞","\\measeq",!0),I(z,_,"≟","\\questeq",!0),I(z,_,"≠","\\ne",!0),I(z,_,"≠","\\neq"),I(z,_,"∷","\\dblcolon",!0),I(z,_,"≔","\\coloneqq",!0),I(z,_,"≕","\\eqqcolon",!0),I(z,_,"∹","\\eqcolon",!0),I(z,_,"⩴","\\Coloneqq",!0),I(z,R,".","\\ldotp"),I(z,R,"·","\\cdotp"),I(z,W,"#","\\#"),I($,W,"#","\\#"),I(z,W,"&","\\&"),I($,W,"&","\\&"),I(z,W,"ℵ","\\aleph",!0),I(z,W,"∀","\\forall",!0),I(z,W,"ℏ","\\hbar",!0),I(z,W,"∃","\\exists",!0),I(z,W,"∇","\\nabla",!0),I(z,W,"♭","\\flat",!0),I(z,W,"ℓ","\\ell",!0),I(z,W,"♮","\\natural",!0),I(z,W,"♣","\\clubsuit",!0),I(z,W,"♧","\\varclubsuit",!0),I(z,W,"℘","\\wp",!0),I(z,W,"♯","\\sharp",!0),I(z,W,"♢","\\diamondsuit",!0),I(z,W,"♦","\\vardiamondsuit",!0),I(z,W,"ℜ","\\Re",!0),I(z,W,"♡","\\heartsuit",!0),I(z,W,"♥","\\varheartsuit",!0),I(z,W,"ℑ","\\Im",!0),I(z,W,"♠","\\spadesuit",!0),I(z,W,"♤","\\varspadesuit",!0),I(z,W,"§","\\S",!0),I($,W,"§","\\S"),I(z,W,"¶","\\P",!0),I($,W,"¶","\\P"),I($,W,"☺","\\smiley"),I(z,W,"☺","\\smiley",!0),I(z,W,"†","\\dag"),I($,W,"†","\\dag"),I($,W,"†","\\textdagger"),I(z,W,"‡","\\ddag"),I($,W,"‡","\\ddag"),I($,W,"‡","\\textdaggerdbl"),I(z,F,"⎱","\\rmoustache",!0),I(z,j,"⎰","\\lmoustache",!0),I(z,F,"⟯","\\rgroup",!0),I(z,j,"⟮","\\lgroup",!0),I(z,D,"∓","\\mp",!0),I(z,D,"⊖","\\ominus",!0),I(z,D,"⊎","\\uplus",!0),I(z,D,"⊓","\\sqcap",!0),I(z,D,"∗","\\ast"),I(z,D,"⊔","\\sqcup",!0),I(z,D,"◯","\\bigcirc",!0),I(z,D,"∙","\\bullet"),I(z,D,"‡","\\ddagger"),I(z,D,"≀","\\wr",!0),I(z,D,"⨿","\\amalg"),I(z,D,"&","\\And"),I(z,_,"⟵","\\longleftarrow",!0),I(z,_,"⇐","\\Leftarrow",!0),I(z,_,"⟸","\\Longleftarrow",!0),I(z,_,"⟶","\\longrightarrow",!0),I(z,_,"⇒","\\Rightarrow",!0),I(z,_,"⟹","\\Longrightarrow",!0),I(z,_,"↔","\\leftrightarrow",!0),I(z,_,"⟷","\\longleftrightarrow",!0),I(z,_,"⇔","\\Leftrightarrow",!0),I(z,_,"⟺","\\Longleftrightarrow",!0),I(z,_,"↦","\\mapsto",!0),I(z,_,"⟼","\\longmapsto",!0),I(z,_,"↗","\\nearrow",!0),I(z,_,"↩","\\hookleftarrow",!0),I(z,_,"↪","\\hookrightarrow",!0),I(z,_,"↘","\\searrow",!0),I(z,_,"↼","\\leftharpoonup",!0),I(z,_,"⇀","\\rightharpoonup",!0),I(z,_,"↙","\\swarrow",!0),I(z,_,"↽","\\leftharpoondown",!0),I(z,_,"⇁","\\rightharpoondown",!0),I(z,_,"↖","\\nwarrow",!0),I(z,_,"⇌","\\rightleftharpoons",!0),I(z,U,"↯","\\lightning",!0),I(z,_,"≮","\\nless",!0),I(z,_,"⪇","\\lneq",!0),I(z,_,"≨","\\lneqq",!0),I(z,_,"≨︀","\\lvertneqq"),I(z,_,"⋦","\\lnsim",!0),I(z,_,"⪉","\\lnapprox",!0),I(z,_,"⊀","\\nprec",!0),I(z,_,"⋠","\\npreceq",!0),I(z,_,"⋨","\\precnsim",!0),I(z,_,"⪹","\\precnapprox",!0),I(z,_,"≁","\\nsim",!0),I(z,_,"∤","\\nmid",!0),I(z,_,"∤","\\nshortmid"),I(z,_,"⊬","\\nvdash",!0),I(z,_,"⊭","\\nvDash",!0),I(z,_,"⋪","\\ntriangleleft"),I(z,_,"⋬","\\ntrianglelefteq",!0),I(z,_,"⊊","\\subsetneq",!0),I(z,_,"⊊︀","\\varsubsetneq"),I(z,_,"⫋","\\subsetneqq",!0),I(z,_,"⫋︀","\\varsubsetneqq"),I(z,_,"≯","\\ngtr",!0),I(z,_,"⪈","\\gneq",!0),I(z,_,"≩","\\gneqq",!0),I(z,_,"≩︀","\\gvertneqq"),I(z,_,"⋧","\\gnsim",!0),I(z,_,"⪊","\\gnapprox",!0),I(z,_,"⊁","\\nsucc",!0),I(z,_,"⋡","\\nsucceq",!0),I(z,_,"⋩","\\succnsim",!0),I(z,_,"⪺","\\succnapprox",!0),I(z,_,"≆","\\ncong",!0),I(z,_,"∦","\\nparallel",!0),I(z,_,"∦","\\nshortparallel"),I(z,_,"⊯","\\nVDash",!0),I(z,_,"⋫","\\ntriangleright"),I(z,_,"⋭","\\ntrianglerighteq",!0),I(z,_,"⊋","\\supsetneq",!0),I(z,_,"⊋","\\varsupsetneq"),I(z,_,"⫌","\\supsetneqq",!0),I(z,_,"⫌︀","\\varsupsetneqq"),I(z,_,"⊮","\\nVdash",!0),I(z,_,"⪵","\\precneqq",!0),I(z,_,"⪶","\\succneqq",!0),I(z,D,"⊴","\\unlhd"),I(z,D,"⊵","\\unrhd"),I(z,_,"↚","\\nleftarrow",!0),I(z,_,"↛","\\nrightarrow",!0),I(z,_,"⇍","\\nLeftarrow",!0),I(z,_,"⇏","\\nRightarrow",!0),I(z,_,"↮","\\nleftrightarrow",!0),I(z,_,"⇎","\\nLeftrightarrow",!0),I(z,_,"△","\\vartriangle"),I(z,W,"ℏ","\\hslash"),I(z,W,"▽","\\triangledown"),I(z,W,"◊","\\lozenge"),I(z,W,"Ⓢ","\\circledS"),I(z,W,"®","\\circledR",!0),I($,W,"®","\\circledR"),I($,W,"®","\\textregistered"),I(z,W,"∡","\\measuredangle",!0),I(z,W,"∄","\\nexists"),I(z,W,"℧","\\mho"),I(z,W,"Ⅎ","\\Finv",!0),I(z,W,"⅁","\\Game",!0),I(z,W,"‵","\\backprime"),I(z,W,"▲","\\blacktriangle"),I(z,W,"▼","\\blacktriangledown"),I(z,W,"■","\\blacksquare"),I(z,W,"⧫","\\blacklozenge"),I(z,W,"★","\\bigstar"),I(z,W,"∢","\\sphericalangle",!0),I(z,W,"∁","\\complement",!0),I(z,W,"ð","\\eth",!0),I($,W,"ð","ð"),I(z,W,"╱","\\diagup"),I(z,W,"╲","\\diagdown"),I(z,W,"□","\\square"),I(z,W,"□","\\Box"),I(z,W,"◊","\\Diamond"),I(z,W,"¥","\\yen",!0),I($,W,"¥","\\yen",!0),I(z,W,"✓","\\checkmark",!0),I($,W,"✓","\\checkmark"),I($,W,"•","\\textbullet"),I(z,W,"ℶ","\\beth",!0),I(z,W,"ℸ","\\daleth",!0),I(z,W,"ℷ","\\gimel",!0),I(z,W,"ϝ","\\digamma",!0),I(z,W,"ϰ","\\varkappa"),I(z,j,"⌜","\\ulcorner",!0),I(z,F,"⌝","\\urcorner",!0),I(z,j,"⌞","\\llcorner",!0),I(z,F,"⌟","\\lrcorner",!0),I(z,_,"≦","\\leqq",!0),I(z,_,"⩽","\\leqslant",!0),I(z,_,"⪕","\\eqslantless",!0),I(z,_,"≲","\\lesssim",!0),I(z,_,"⪅","\\lessapprox",!0),I(z,_,"≊","\\approxeq",!0),I(z,D,"⋖","\\lessdot"),I(z,_,"⋘","\\lll",!0),I(z,_,"≶","\\lessgtr",!0),I(z,_,"⋚","\\lesseqgtr",!0),I(z,_,"⪋","\\lesseqqgtr",!0),I(z,_,"≑","\\doteqdot"),I(z,_,"≓","\\risingdotseq",!0),I(z,_,"≒","\\fallingdotseq",!0),I(z,_,"∽","\\backsim",!0),I(z,_,"⋍","\\backsimeq",!0),I(z,_,"⫅","\\subseteqq",!0),I(z,_,"⋐","\\Subset",!0),I(z,_,"⊏","\\sqsubset",!0),I(z,_,"≼","\\preccurlyeq",!0),I(z,_,"⋞","\\curlyeqprec",!0),I(z,_,"≾","\\precsim",!0),I(z,_,"⪷","\\precapprox",!0),I(z,_,"⊲","\\vartriangleleft"),I(z,_,"⊴","\\trianglelefteq"),I(z,_,"⊨","\\vDash",!0),I(z,_,"⊪","\\Vvdash",!0),I(z,_,"⌣","\\smallsmile"),I(z,_,"⌢","\\smallfrown"),I(z,_,"≏","\\bumpeq",!0),I(z,_,"≎","\\Bumpeq",!0),I(z,_,"≧","\\geqq",!0),I(z,_,"⩾","\\geqslant",!0),I(z,_,"⪖","\\eqslantgtr",!0),I(z,_,"≳","\\gtrsim",!0),I(z,_,"⪆","\\gtrapprox",!0),I(z,D,"⋗","\\gtrdot"),I(z,_,"⋙","\\ggg",!0),I(z,_,"≷","\\gtrless",!0),I(z,_,"⋛","\\gtreqless",!0),I(z,_,"⪌","\\gtreqqless",!0),I(z,_,"≖","\\eqcirc",!0),I(z,_,"≗","\\circeq",!0),I(z,_,"≜","\\triangleq",!0),I(z,_,"∼","\\thicksim"),I(z,_,"≈","\\thickapprox"),I(z,_,"⫆","\\supseteqq",!0),I(z,_,"⋑","\\Supset",!0),I(z,_,"⊐","\\sqsupset",!0),I(z,_,"≽","\\succcurlyeq",!0),I(z,_,"⋟","\\curlyeqsucc",!0),I(z,_,"≿","\\succsim",!0),I(z,_,"⪸","\\succapprox",!0),I(z,_,"⊳","\\vartriangleright"),I(z,_,"⊵","\\trianglerighteq"),I(z,_,"⊩","\\Vdash",!0),I(z,_,"∣","\\shortmid"),I(z,_,"∥","\\shortparallel"),I(z,_,"≬","\\between",!0),I(z,_,"⋔","\\pitchfork",!0),I(z,_,"∝","\\varpropto"),I(z,_,"◀","\\blacktriangleleft"),I(z,_,"∴","\\therefore",!0),I(z,_,"∍","\\backepsilon"),I(z,_,"▶","\\blacktriangleright"),I(z,_,"∵","\\because",!0),I(z,_,"⋘","\\llless"),I(z,_,"⋙","\\gggtr"),I(z,D,"⊲","\\lhd"),I(z,D,"⊳","\\rhd"),I(z,_,"≂","\\eqsim",!0),I(z,_,"⋈","\\Join"),I(z,_,"≑","\\Doteq",!0),I(z,D,"∔","\\dotplus",!0),I(z,D,"∖","\\smallsetminus"),I(z,D,"⋒","\\Cap",!0),I(z,D,"⋓","\\Cup",!0),I(z,D,"⩞","\\doublebarwedge",!0),I(z,D,"⊟","\\boxminus",!0),I(z,D,"⊞","\\boxplus",!0),I(z,D,"⋇","\\divideontimes",!0),I(z,D,"⋉","\\ltimes",!0),I(z,D,"⋊","\\rtimes",!0),I(z,D,"⋋","\\leftthreetimes",!0),I(z,D,"⋌","\\rightthreetimes",!0),I(z,D,"⋏","\\curlywedge",!0),I(z,D,"⋎","\\curlyvee",!0),I(z,D,"⊝","\\circleddash",!0),I(z,D,"⊛","\\circledast",!0),I(z,D,"⋅","\\centerdot"),I(z,D,"⊺","\\intercal",!0),I(z,D,"⋒","\\doublecap"),I(z,D,"⋓","\\doublecup"),I(z,D,"⊠","\\boxtimes",!0),I(z,_,"⇢","\\dashrightarrow",!0),I(z,_,"⇠","\\dashleftarrow",!0),I(z,_,"⇇","\\leftleftarrows",!0),I(z,_,"⇆","\\leftrightarrows",!0),I(z,_,"⇚","\\Lleftarrow",!0),I(z,_,"↞","\\twoheadleftarrow",!0),I(z,_,"↢","\\leftarrowtail",!0),I(z,_,"↫","\\looparrowleft",!0),I(z,_,"⇋","\\leftrightharpoons",!0),I(z,_,"↶","\\curvearrowleft",!0),I(z,_,"↺","\\circlearrowleft",!0),I(z,_,"↰","\\Lsh",!0),I(z,_,"⇈","\\upuparrows",!0),I(z,_,"↿","\\upharpoonleft",!0),I(z,_,"⇃","\\downharpoonleft",!0),I(z,_,"⊶","\\origof",!0),I(z,_,"⊷","\\imageof",!0),I(z,_,"⊸","\\multimap",!0),I(z,_,"↭","\\leftrightsquigarrow",!0),I(z,_,"⇉","\\rightrightarrows",!0),I(z,_,"⇄","\\rightleftarrows",!0),I(z,_,"↠","\\twoheadrightarrow",!0),I(z,_,"↣","\\rightarrowtail",!0),I(z,_,"↬","\\looparrowright",!0),I(z,_,"↷","\\curvearrowright",!0),I(z,_,"↻","\\circlearrowright",!0),I(z,_,"↱","\\Rsh",!0),I(z,_,"⇊","\\downdownarrows",!0),I(z,_,"↾","\\upharpoonright",!0),I(z,_,"⇂","\\downharpoonright",!0),I(z,_,"⇝","\\rightsquigarrow",!0),I(z,_,"⇝","\\leadsto"),I(z,_,"⇛","\\Rrightarrow",!0),I(z,_,"↾","\\restriction"),I(z,W,"‘","`"),I(z,W,"$","\\$"),I($,W,"$","\\$"),I($,W,"$","\\textdollar"),I(z,W,"%","\\%"),I($,W,"%","\\%"),I(z,W,"_","\\_"),I($,W,"_","\\_"),I($,W,"_","\\textunderscore"),I($,W,"␣","\\textvisiblespace",!0),I(z,W,"∠","\\angle",!0),I(z,W,"∞","\\infty",!0),I(z,W,"′","\\prime"),I(z,W,"△","\\triangle"),I(z,W,"Α","\\Alpha",!0),I(z,W,"Β","\\Beta",!0),I(z,W,"Γ","\\Gamma",!0),I(z,W,"Δ","\\Delta",!0),I(z,W,"Ε","\\Epsilon",!0),I(z,W,"Ζ","\\Zeta",!0),I(z,W,"Η","\\Eta",!0),I(z,W,"Θ","\\Theta",!0),I(z,W,"Ι","\\Iota",!0),I(z,W,"Κ","\\Kappa",!0),I(z,W,"Λ","\\Lambda",!0),I(z,W,"Μ","\\Mu",!0),I(z,W,"Ν","\\Nu",!0),I(z,W,"Ξ","\\Xi",!0),I(z,W,"Ο","\\Omicron",!0),I(z,W,"Π","\\Pi",!0),I(z,W,"Ρ","\\Rho",!0),I(z,W,"Σ","\\Sigma",!0),I(z,W,"Τ","\\Tau",!0),I(z,W,"Υ","\\Upsilon",!0),I(z,W,"Φ","\\Phi",!0),I(z,W,"Χ","\\Chi",!0),I(z,W,"Ψ","\\Psi",!0),I(z,W,"Ω","\\Omega",!0),I(z,W,"A","Α"),I(z,W,"B","Β"),I(z,W,"E","Ε"),I(z,W,"Z","Ζ"),I(z,W,"H","Η"),I(z,W,"I","Ι"),I(z,W,"K","Κ"),I(z,W,"M","Μ"),I(z,W,"N","Ν"),I(z,W,"O","Ο"),I(z,W,"P","Ρ"),I(z,W,"T","Τ"),I(z,W,"X","Χ"),I(z,W,"¬","\\neg",!0),I(z,W,"¬","\\lnot"),I(z,W,"⊤","\\top"),I(z,W,"⊥","\\bot"),I(z,W,"∅","\\emptyset"),I(z,W,"∅","\\varnothing"),I(z,U,"α","\\alpha",!0),I(z,U,"β","\\beta",!0),I(z,U,"γ","\\gamma",!0),I(z,U,"δ","\\delta",!0),I(z,U,"ϵ","\\epsilon",!0),I(z,U,"ζ","\\zeta",!0),I(z,U,"η","\\eta",!0),I(z,U,"θ","\\theta",!0),I(z,U,"ι","\\iota",!0),I(z,U,"κ","\\kappa",!0),I(z,U,"λ","\\lambda",!0),I(z,U,"μ","\\mu",!0),I(z,U,"ν","\\nu",!0),I(z,U,"ξ","\\xi",!0),I(z,U,"ο","\\omicron",!0),I(z,U,"π","\\pi",!0),I(z,U,"ρ","\\rho",!0),I(z,U,"σ","\\sigma",!0),I(z,U,"τ","\\tau",!0),I(z,U,"υ","\\upsilon",!0),I(z,U,"ϕ","\\phi",!0),I(z,U,"χ","\\chi",!0),I(z,U,"ψ","\\psi",!0),I(z,U,"ω","\\omega",!0),I(z,U,"ε","\\varepsilon",!0),I(z,U,"ϑ","\\vartheta",!0),I(z,U,"ϖ","\\varpi",!0),I(z,U,"ϱ","\\varrho",!0),I(z,U,"ς","\\varsigma",!0),I(z,U,"φ","\\varphi",!0),I(z,U,"Ϙ","\\Coppa",!0),I(z,U,"ϙ","\\coppa",!0),I(z,U,"ϙ","\\varcoppa",!0),I(z,U,"Ϟ","\\Koppa",!0),I(z,U,"ϟ","\\koppa",!0),I(z,U,"Ϡ","\\Sampi",!0),I(z,U,"ϡ","\\sampi",!0),I(z,U,"Ϛ","\\Stigma",!0),I(z,U,"ϛ","\\stigma",!0),I(z,D,"∗","*"),I(z,D,"+","+"),I(z,D,"−","-"),I(z,D,"⋅","\\cdot",!0),I(z,D,"∘","\\circ"),I(z,D,"÷","\\div",!0),I(z,D,"±","\\pm",!0),I(z,D,"×","\\times",!0),I(z,D,"∩","\\cap",!0),I(z,D,"∪","\\cup",!0),I(z,D,"∖","\\setminus"),I(z,D,"∧","\\land"),I(z,D,"∨","\\lor"),I(z,D,"∧","\\wedge",!0),I(z,D,"∨","\\vee",!0),I(z,W,"√","\\surd"),I(z,j,"⟦","\\llbracket",!0),I(z,F,"⟧","\\rrbracket",!0),I(z,j,"⟨","\\langle",!0),I(z,j,"|","\\lvert"),I(z,j,"‖","\\lVert"),I(z,F,"?","?"),I(z,F,"!","!"),I(z,F,"‼","‼"),I(z,F,"⟩","\\rangle",!0),I(z,F,"|","\\rvert"),I(z,F,"‖","\\rVert"),I(z,j,"⦃","\\lBrace",!0),I(z,F,"⦄","\\rBrace",!0),I(z,_,"=","="),I(z,_,":",":"),I(z,_,"≈","\\approx",!0),I(z,_,"≅","\\cong",!0),I(z,_,"≥","\\ge"),I(z,_,"≥","\\geq",!0),I(z,_,"←","\\gets"),I(z,_,">","\\gt",!0),I(z,_,"∈","\\in",!0),I(z,_,"∉","\\notin",!0),I(z,_,"","\\@not"),I(z,_,"⊂","\\subset",!0),I(z,_,"⊃","\\supset",!0),I(z,_,"⊆","\\subseteq",!0),I(z,_,"⊇","\\supseteq",!0),I(z,_,"⊈","\\nsubseteq",!0),I(z,_,"⊈","\\nsubseteqq"),I(z,_,"⊉","\\nsupseteq",!0),I(z,_,"⊉","\\nsupseteqq"),I(z,_,"⊨","\\models"),I(z,_,"←","\\leftarrow",!0),I(z,_,"≤","\\le"),I(z,_,"≤","\\leq",!0),I(z,_,"<","\\lt",!0),I(z,_,"→","\\rightarrow",!0),I(z,_,"→","\\to"),I(z,_,"≱","\\ngeq",!0),I(z,_,"≱","\\ngeqq"),I(z,_,"≱","\\ngeqslant"),I(z,_,"≰","\\nleq",!0),I(z,_,"≰","\\nleqq"),I(z,_,"≰","\\nleqslant"),I(z,V," ","\\ "),I(z,V," ","~"),I(z,V," ","\\space"),I(z,V," ","\\nobreakspace"),I($,V," ","\\ "),I($,V," "," "),I($,V," ","~"),I($,V," ","\\space"),I($,V," ","\\nobreakspace"),I(z,V,null,"\\nobreak"),I(z,V,null,"\\allowbreak"),I(z,R,",",","),I(z,R,";",";"),I(z,D,"⊼","\\barwedge",!0),I(z,D,"⊻","\\veebar",!0),I(z,D,"⊙","\\odot",!0),I(z,D,"⊕","\\oplus",!0),I(z,D,"⊗","\\otimes",!0),I(z,W,"∂","\\partial",!0),I(z,D,"⊘","\\oslash",!0),I(z,D,"⊚","\\circledcirc",!0),I(z,D,"⊡","\\boxdot",!0),I(z,D,"△","\\bigtriangleup"),I(z,D,"▽","\\bigtriangledown"),I(z,D,"†","\\dagger"),I(z,D,"⋄","\\diamond"),I(z,D,"⋆","\\star"),I(z,D,"◃","\\triangleleft"),I(z,D,"▹","\\triangleright"),I(z,j,"{","\\{"),I($,W,"{","\\{"),I($,W,"{","\\textbraceleft"),I(z,F,"}","\\}"),I($,W,"}","\\}"),I($,W,"}","\\textbraceright"),I(z,j,"{","\\lbrace"),I(z,F,"}","\\rbrace"),I(z,j,"[","\\lbrack",!0),I($,W,"[","\\lbrack",!0),I(z,F,"]","\\rbrack",!0),I($,W,"]","\\rbrack",!0),I(z,j,"(","\\lparen",!0),I(z,F,")","\\rparen",!0),I($,W,"<","\\textless",!0),I($,W,">","\\textgreater",!0),I(z,j,"⌊","\\lfloor",!0),I(z,F,"⌋","\\rfloor",!0),I(z,j,"⌈","\\lceil",!0),I(z,F,"⌉","\\rceil",!0),I(z,W,"\\","\\backslash"),I(z,W,"|","|"),I(z,W,"|","\\vert"),I($,W,"|","\\textbar",!0),I(z,W,"‖","\\|"),I(z,W,"‖","\\Vert"),I($,W,"‖","\\textbardbl"),I($,W,"~","\\textasciitilde"),I($,W,"\\","\\textbackslash"),I($,W,"^","\\textasciicircum"),I(z,_,"↑","\\uparrow",!0),I(z,_,"⇑","\\Uparrow",!0),I(z,_,"↓","\\downarrow",!0),I(z,_,"⇓","\\Downarrow",!0),I(z,_,"↕","\\updownarrow",!0),I(z,_,"⇕","\\Updownarrow",!0),I(z,P,"∐","\\coprod"),I(z,P,"⋁","\\bigvee"),I(z,P,"⋀","\\bigwedge"),I(z,P,"⨄","\\biguplus"),I(z,P,"⋂","\\bigcap"),I(z,P,"⋃","\\bigcup"),I(z,P,"∫","\\int"),I(z,P,"∫","\\intop"),I(z,P,"∬","\\iint"),I(z,P,"∭","\\iiint"),I(z,P,"∏","\\prod"),I(z,P,"∑","\\sum"),I(z,P,"⨂","\\bigotimes"),I(z,P,"⨁","\\bigoplus"),I(z,P,"⨀","\\bigodot"),I(z,P,"∮","\\oint"),I(z,P,"∯","\\oiint"),I(z,P,"∰","\\oiiint"),I(z,P,"∱","\\intclockwise"),I(z,P,"∲","\\varointclockwise"),I(z,P,"⨌","\\iiiint"),I(z,P,"⨍","\\intbar"),I(z,P,"⨎","\\intBar"),I(z,P,"⨏","\\fint"),I(z,P,"⨒","\\rppolint"),I(z,P,"⨓","\\scpolint"),I(z,P,"⨕","\\pointint"),I(z,P,"⨖","\\sqint"),I(z,P,"⨗","\\intlarhk"),I(z,P,"⨘","\\intx"),I(z,P,"⨙","\\intcap"),I(z,P,"⨚","\\intcup"),I(z,P,"⨅","\\bigsqcap"),I(z,P,"⨆","\\bigsqcup"),I(z,P,"∫","\\smallint"),I($,G,"…","\\textellipsis"),I(z,G,"…","\\mathellipsis"),I($,G,"…","\\ldots",!0),I(z,G,"…","\\ldots",!0),I(z,G,"⋰","\\iddots",!0),I(z,G,"⋯","\\@cdots",!0),I(z,G,"⋱","\\ddots",!0),I(z,W,"⋮","\\varvdots"),I(z,L,"ˊ","\\acute"),I(z,L,"ˋ","\\grave"),I(z,L,"¨","\\ddot"),I(z,L,"⃛","\\dddot"),I(z,L,"⃜","\\ddddot"),I(z,L,"~","\\tilde"),I(z,L,"ˉ","\\bar"),I(z,L,"˘","\\breve"),I(z,L,"ˇ","\\check"),I(z,L,"^","\\hat"),I(z,L,"⃗","\\vec"),I(z,L,"˙","\\dot"),I(z,L,"˚","\\mathring"),I(z,U,"ı","\\imath",!0),I(z,U,"ȷ","\\jmath",!0),I(z,W,"ı","ı"),I(z,W,"ȷ","ȷ"),I($,W,"ı","\\i",!0),I($,W,"ȷ","\\j",!0),I($,W,"ß","\\ss",!0),I($,W,"æ","\\ae",!0),I($,W,"œ","\\oe",!0),I($,W,"ø","\\o",!0),I($,W,"Æ","\\AE",!0),I($,W,"Œ","\\OE",!0),I($,W,"Ø","\\O",!0),I($,L,"ˊ","\\'"),I($,L,"ˋ","\\`"),I($,L,"ˆ","\\^"),I($,L,"˜","\\~"),I($,L,"ˉ","\\="),I($,L,"˘","\\u"),I($,L,"˙","\\."),I($,L,"˚","\\r"),I($,L,"ˇ","\\v"),I($,L,"¨",'\\"'),I($,L,"˝","\\H");const H={"--":!0,"---":!0,"``":!0,"''":!0};I($,W,"–","--",!0),I($,W,"–","\\textendash"),I($,W,"—","---",!0),I($,W,"—","\\textemdash"),I($,W,"‘","`",!0),I($,W,"‘","\\textquoteleft"),I($,W,"’","'",!0),I($,W,"’","\\textquoteright"),I($,W,"“","``",!0),I($,W,"“","\\textquotedblleft"),I($,W,"”","''",!0),I($,W,"”","\\textquotedblright"),I(z,W,"°","\\degree",!0),I($,W,"°","\\degree"),I($,W,"°","\\textdegree",!0),I(z,W,"£","\\pounds"),I(z,W,"£","\\mathsterling",!0),I($,W,"£","\\pounds"),I($,W,"£","\\textsterling",!0),I(z,W,"✠","\\maltese"),I($,W,"✠","\\maltese"),I(z,W,"€","\\euro"),I($,W,"€","\\euro"),I($,W,"€","\\texteuro"),I(z,W,"©","\\copyright",!0),I($,W,"©","\\textcopyright"),I(z,W,"𝛤","\\varGamma"),I(z,W,"𝛥","\\varDelta"),I(z,W,"𝛩","\\varTheta"),I(z,W,"𝛬","\\varLambda"),I(z,W,"𝛯","\\varXi"),I(z,W,"𝛱","\\varPi"),I(z,W,"𝛴","\\varSigma"),I(z,W,"𝛶","\\varUpsilon"),I(z,W,"𝛷","\\varPhi"),I(z,W,"𝛹","\\varPsi"),I(z,W,"𝛺","\\varOmega"),I($,W,"𝛤","\\varGamma"),I($,W,"𝛥","\\varDelta"),I($,W,"𝛩","\\varTheta"),I($,W,"𝛬","\\varLambda"),I($,W,"𝛯","\\varXi"),I($,W,"𝛱","\\varPi"),I($,W,"𝛴","\\varSigma"),I($,W,"𝛶","\\varUpsilon"),I($,W,"𝛷","\\varPhi"),I($,W,"𝛹","\\varPsi"),I($,W,"𝛺","\\varOmega");const X='0123456789/@."';for(let e=0;e<X.length;e++){const t=X.charAt(e);I(z,W,t,t)}const Z='0123456789!@*()-=+";:?/.,';for(let e=0;e<Z.length;e++){const t=Z.charAt(e);I($,W,t,t)}const Y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(let e=0;e<Y.length;e++){const t=Y.charAt(e);I(z,U,t,t),I($,W,t,t)}const J="ÇÐÞçþℂℍℕℙℚℝℤℎℏℊℋℌℐℑℒℓ℘ℛℜℬℰℱℳℭℨ";for(let e=0;e<J.length;e++){const t=J.charAt(e);I(z,U,t,t),I($,W,t,t)}let K="";for(let e=0;e<Y.length;e++){K=String.fromCharCode(55349,56320+e),I(z,U,K,K),I($,W,K,K),K=String.fromCharCode(55349,56372+e),I(z,U,K,K),I($,W,K,K),K=String.fromCharCode(55349,56424+e),I(z,U,K,K),I($,W,K,K),K=String.fromCharCode(55349,56580+e),I(z,U,K,K),I($,W,K,K),K=String.fromCharCode(55349,56736+e),I(z,U,K,K),I($,W,K,K),K=String.fromCharCode(55349,56788+e),I(z,U,K,K),I($,W,K,K),K=String.fromCharCode(55349,56840+e),I(z,U,K,K),I($,W,K,K),K=String.fromCharCode(55349,56944+e),I(z,U,K,K),I($,W,K,K),K=String.fromCharCode(55349,56632+e),I(z,U,K,K),I($,W,K,K);const t=Y.charAt(e);K=String.fromCharCode(55349,56476+e),I(z,U,t,K),I($,W,t,K)}for(let e=0;e<10;e++)K=String.fromCharCode(55349,57294+e),I(z,U,K,K),I($,W,K,K),K=String.fromCharCode(55349,57314+e),I(z,U,K,K),I($,W,K,K),K=String.fromCharCode(55349,57324+e),I(z,U,K,K),I($,W,K,K),K=String.fromCharCode(55349,57334+e),I(z,U,K,K),I($,W,K,K);const Q=function(e,t,r){return!E[t][e]||!E[t][e].replace||55349===e.charCodeAt(0)||Object.prototype.hasOwnProperty.call(H,e)&&r&&(r.fontFamily&&"tt"===r.fontFamily.substr(4,2)||r.font&&"tt"===r.font.substr(4,2))||(e=E[t][e].replace),new N.TextNode(e)},ee=function(e){return 1===e.length?e[0]:new N.MathNode("mrow",e)},te=function(e,t,r){if(1===e.length){const n=ne(e[0],t);return r&&n instanceof A&&"mo"===n.type&&(n.setAttribute("lspace","0em"),n.setAttribute("rspace","0em")),[n]}const n=[];for(let r=0;r<e.length;r++){const o=ne(e[r],t);n.push(o)}return n},re=function(e,t,r){return ee(te(e,t,r))},ne=function(t,r){if(!t)return new N.MathNode("mrow");if(l[t.type]){return l[t.type](t,r)}throw new e("Got group of unknown type: '"+t.type+"'")};function oe(e,t,r,n){let o=null;1===e.length&&"tag"===e[0].type&&(o=e[0].tag,e=e[0].body);const a=te(e,r);let i=1===a.length&&null!==o&&a[0]instanceof A&&s.contains(["mrow","mtable"],a[0].type)?a[0]:function(e,t){const r=[];let n=[],o=[],s=!1;for(let t=0;t<e.length;t++){const a=e[t];if(a.attributes&&a.attributes.linebreak&&"newline"===a.attributes.linebreak){o.length>0&&n.push(new N.MathNode("mrow",o)),n.push(a),o=[];const e=new N.MathNode("mtd",n);r.push(new N.MathNode("mtr",[e])),n=[]}else if(o.push(a),a.type&&"mo"===a.type){if(s&&!a.attributes.form){const r=t<e.length-1?e[t+1]:null;let a=!0;if(!r||"mtext"!==r.type||!r.attributes.linebreak||"nobreak"!==r.attributes.linebreak)for(let r=t+1;r<e.length;r++){const n=e[r];if(!n.type||"mspace"!==n.type||n.attributes.linebreak&&"newline"===n.attributes.linebreak)break;o.push(n),t+=1,n.attributes&&n.attributes.linebreak&&"nobreak"===n.attributes.linebreak&&(a=!1)}a&&(n.push(new N.MathNode("mrow",o)),o=[]),s=!1}const r=a.attributes.form&&"prefix"===a.attributes.form;s=!(a.attributes.separator||r)}else s=!0}if(o.length>0&&n.push(new N.MathNode("mrow",o)),r.length>0){const e=new N.MathNode("mtd",n),o=new N.MathNode("mtr",[e]);r.push(o);const s=new N.MathNode("mtable",r);return t||(s.setAttribute("columnalign","left"),s.setAttribute("rowspacing","0em")),s}return N.newDocumentFragment(n)}(a,n.displayMode);o?i=((e,t,r,n)=>{const o=new N.MathNode("mtd",[]);o.setAttribute("style","padding: 0;width: 50%;"),(t=re(t[0].body,r)).classes=["tml-tag"],(t=new N.MathNode("mpadded",[t])).setAttribute("style","width:0;"),t.setAttribute("width","0"),t.setAttribute(n?"rspace":"lspace","-1width"),(t=new N.MathNode("mtd",[t])).setAttribute("style","padding: 0; min-width:0"),e=new N.MathNode("mtd",[e]);const s=n?[t,o,e,o]:[o,e,o,t],a=new N.MathNode("mtr",s,["tml-tageqn"]),i=new N.MathNode("mtable",[a]);return i.setAttribute("width","100%"),i})(i,o,r,n.leqno):1===i.children.length&&n.displayMode&&(i.children[0].setAttribute("display","block"),i.children[0].setAttribute("style","width: 100%;"));const l=new N.MathNode("math",[i],["temml"]);return l.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),l.setAttribute("data-tex",t),n.displayMode&&l.setAttribute("display","block"),l}const se=(e,t)=>{const r=e.isStretchy?B(e.label):new N.MathNode("mo",[Q(e.label,e.mode)]),n=new N.MathNode("mover",[ne(e.base,t),r]);return n.setAttribute("accent","true"),n},ae=new RegExp(["\\acute","\\grave","\\ddot","\\dddot","\\ddddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map((e=>`\\${e}`)).join("|"));c({type:"accent",names:["\\acute","\\grave","\\ddot","\\dddot","\\ddddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\overparen","\\widecheck","\\widehat","\\wideparen","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(e,t)=>{const r=m(t[0]),n=!ae.test(e.funcName),o=!n||"\\widehat"===e.funcName||"\\widetilde"===e.funcName||"\\widecheck"===e.funcName;return{type:"accent",mode:e.parser.mode,label:e.funcName,isStretchy:n,isShifty:o,base:r}},mathmlBuilder:se}),c({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\r","\\H","\\v"],props:{numArgs:1,allowedInText:!0,allowedInMath:!1,argTypes:["primitive"]},handler:(e,t)=>{const r=t[0];return{type:"accent",mode:e.parser.mode,label:e.funcName,isStretchy:!1,isShifty:!0,base:r}},mathmlBuilder:se}),c({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underparen","\\utilde"],props:{numArgs:1},handler:({parser:e,funcName:t},r)=>{const n=r[0];return{type:"accentUnder",mode:e.mode,label:t,base:n}},mathmlBuilder:(e,t)=>{const r=B(e.label),n=new N.MathNode("munder",[ne(e.base,t),r]);return n.setAttribute("accentunder","true"),n}});const ie=(e,t="+0.6em")=>{const r=new N.MathNode("mpadded",e?[e]:[]);return r.setAttribute("width",t),r.setAttribute("lspace","0.3em"),r};function le(e,t){if(!e||e.type!==t)throw new Error(`Expected node of type ${t}, but got `+(e?`node of type ${e.type}`:String(e)));return e}function ce(e){const t=pe(e);if(!t)throw new Error("Expected node of symbol group type, but got "+(e?`node of type ${e.type}`:String(e)));return t}function pe(e){return e&&("atom"===e.type||Object.prototype.hasOwnProperty.call(C,e.type))?e:null}c({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\longrightleftharpoons","\\longleftrightarrows","\\longRightleftharpoons","\\longLeftrightharpoons","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler:({parser:e,funcName:t},r,n)=>({type:"xArrow",mode:e.mode,label:t,body:r[0],below:n[0],macros:e.gullet.macros}),mathmlBuilder(e,t){const r=B(e.label,e.macros),n="x"===e.label.charAt(1)?"1.75em":"3.0em";r.setAttribute("minsize",n);const o=t.incrementLevel(),s=e.body&&e.body.body.length>0?ie(ne(e.body,o)):ie(null,n),a=e.below&&e.below.body.length>0?ie(ne(e.below,o)):ie(null,n);return new N.MathNode("munderover",[r,a,s])}}),c({type:"cancelto",names:["\\cancelto"],props:{numArgs:2},handler:({parser:e},t)=>({type:"cancelto",mode:e.mode,value:t[0],expression:t[1]}),mathmlBuilder(e,t){const r=new N.MathNode("mpadded",[ne(e.value,t)]);r.setAttribute("depth","-0.1em"),r.setAttribute("height","+0.1em"),r.setAttribute("voffset","0.1em");const n=new N.MathNode("menclose",[ne(e.expression,t)]);return n.setAttribute("notation","updiagonalarrow"),new N.MathNode("msup",[n,r])}});const me={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},ue=e=>"textord"===e.type&&"@"===e.text;function de(e,t,r){const n=me[e];switch(n){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return r.callFunction(n,[t[0]],[t[1]]);case"\\uparrow":case"\\downarrow":{const e={type:"atom",text:n,mode:"math",family:"rel"},o={type:"ordgroup",mode:"math",body:[r.callFunction("\\\\cdleft",[t[0]],[]),r.callFunction("\\Big",[e],[]),r.callFunction("\\\\cdright",[t[1]],[])]};return r.callFunction("\\\\cdparent",[o],[])}case"\\\\cdlongequal":return r.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{const e={type:"textord",text:"\\Vert",mode:"math"};return r.callFunction("\\Big",[e],[])}default:return{type:"textord",text:" ",mode:"math"}}}c({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler:({parser:e,funcName:t},r)=>({type:"cdlabel",mode:e.mode,side:t.slice(4),label:r[0]}),mathmlBuilder(e,t){let r=new N.MathNode("mrow",[ne(e.label,t)]);return r=new N.MathNode("mpadded",[r]),r.setAttribute("width","0"),"left"===e.side&&r.setAttribute("lspace","-1width"),r.setAttribute("voffset","0.7em"),r=new N.MathNode("mstyle",[r]),r.setAttribute("displaystyle","false"),r.setAttribute("scriptlevel","1"),r}}),c({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler:({parser:e},t)=>({type:"cdlabelparent",mode:e.mode,fragment:t[0]}),mathmlBuilder:(e,t)=>new N.MathNode("mrow",[ne(e.fragment,t)])}),c({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler({parser:t},r){const n=le(r[0],"ordgroup").body;let o="";for(let e=0;e<n.length;e++){o+=le(n[e],"textord").text}const s=parseInt(o);if(isNaN(s))throw new e(`\\@char has non-numeric argument ${o}`);return{type:"textord",mode:t.mode,text:String.fromCharCode(s)}}});const he=(e,t)=>{const r=te(e.body,t.withColor(e.color)),n=new N.MathNode("mstyle",r);return n.setAttribute("mathcolor",e.color),n};c({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler({parser:e},t){const r=le(t[0],"color-token").color,n=t[1];return{type:"color",mode:e.mode,color:r,body:u(n)}},mathmlBuilder:he}),c({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler({parser:e,breakOnTokenText:t},r){const n=le(r[0],"color-token").color;e.gullet.macros.set("\\current@color",n);const o=e.parseExpression(!0,t);return{type:"color",mode:e.mode,color:n,body:o}},mathmlBuilder:he});const ge={pt:800/803,pc:9600/803,dd:1238/1157*800/803,cc:12.792133216944668,nd:685/642*800/803,nc:1370/107*800/803,sp:1/65536*800/803},be=["em","ex","mu","pt","mm","cm","in","px","bp","pc","dd","cc","nd","nc","sp"],fe=function(e){return"string"!=typeof e&&(e=e.unit),be.indexOf(e)>-1},ye=function(t,r){const n=t.number,o=t.unit;switch(o){case"mm":case"cm":case"in":case"px":return{number:n,unit:o};case"em":case"ex":return{number:s.round(n/(a=r.level,[1,.7,.5][Math.max(a-1,0)])),unit:o};case"bp":return{number:n,unit:"pt"};case"pt":case"pc":case"dd":case"cc":case"nd":case"nc":case"sp":return{number:s.round(n*ge[o]),unit:"pt"};case"mu":return{number:s.round(n/18),unit:"em"};default:throw new e("Invalid unit: '"+o+"'")}var a};c({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:1,argTypes:["size"],allowedInText:!0},handler({parser:e},t,r){const n=r[0];e.settings.displayMode&&"warn"===e.settings.strict&&e.settings.reportNonstrict("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");const o=!e.settings.displayMode||!0!==e.settings.strict;return{type:"cr",mode:e.mode,newLine:o,size:n&&le(n,"size").value}},mathmlBuilder(e,t){const r=new N.MathNode("mo");if(e.newLine&&(r.setAttribute("linebreak","newline"),e.size)){const n=ye(e.size,t);r.setAttribute("height",n.number+n.unit)}return r}});const we={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},xe=t=>{const r=t.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(r))throw new e("Expected a control sequence",t);return r},ke=(e,t,r,n)=>{let o=e.gullet.macros.get(r.text);null==o&&(r.noexpand=!0,o={tokens:[r],numArgs:0,unexpandable:!e.gullet.isExpandable(r.text)}),e.gullet.macros.set(t,o,n)};c({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler({parser:t,funcName:r}){t.consumeSpaces();const n=t.fetch();if(we[n.text])return"\\global"!==r&&"\\\\globallong"!==r||(n.text=we[n.text]),le(t.parseFunction(),"internal");throw new e("Invalid token after macro prefix",n)}}),c({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler({parser:t,funcName:r}){let n=t.gullet.popToken();const o=n.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(o))throw new e("Expected a control sequence",n);let s,a=0;const i=[[]];for(;"{"!==t.gullet.future().text;)if(n=t.gullet.popToken(),"#"===n.text){if("{"===t.gullet.future().text){s=t.gullet.future(),i[a].push("{");break}if(n=t.gullet.popToken(),!/^[1-9]$/.test(n.text))throw new e(`Invalid argument number "${n.text}"`);if(parseInt(n.text)!==a+1)throw new e(`Argument number "${n.text}" out of order`);a++,i.push([])}else{if("EOF"===n.text)throw new e("Expected a macro definition");i[a].push(n.text)}let{tokens:l}=t.gullet.consumeArg();return s&&l.unshift(s),"\\edef"!==r&&"\\xdef"!==r||(l=t.gullet.expandTokens(l),l.reverse()),t.gullet.macros.set(o,{tokens:l,numArgs:a,delimiters:i},r===we[r]),{type:"internal",mode:t.mode}}}),c({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler({parser:e,funcName:t}){const r=xe(e.gullet.popToken());e.gullet.consumeSpaces();const n=(e=>{let t=e.gullet.popToken();return"="===t.text&&(t=e.gullet.popToken()," "===t.text&&(t=e.gullet.popToken())),t})(e);return ke(e,r,n,"\\\\globallet"===t),{type:"internal",mode:e.mode}}}),c({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler({parser:e,funcName:t}){const r=xe(e.gullet.popToken()),n=e.gullet.popToken(),o=e.gullet.popToken();return ke(e,r,o,"\\\\globalfuture"===t),e.gullet.pushToken(o),e.gullet.pushToken(n),{type:"internal",mode:e.mode}}}),c({type:"internal",names:["\\newcommand","\\renewcommand","\\providecommand"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler({parser:t,funcName:r}){let n="";const o=t.gullet.popToken();"{"===o.text?(n=xe(t.gullet.popToken()),t.gullet.popToken()):n=xe(o);const s=t.gullet.isDefined(n);if(s&&"\\newcommand"===r)throw new e(`\\newcommand{${n}} attempting to redefine ${n}; use \\renewcommand`);if(!s&&"\\renewcommand"===r)throw new e(`\\renewcommand{${n}} when command ${n} does not yet exist; use \\newcommand`);let a=0;if("["===t.gullet.future().text){let r=t.gullet.popToken();if(r=t.gullet.popToken(),!/^[0-9]$/.test(r.text))throw new e(`Invalid number of arguments: "${r.text}"`);if(a=parseInt(r.text),r=t.gullet.popToken(),"]"!==r.text)throw new e(`Invalid argument "${r.text}"`)}const{tokens:i}=t.gullet.consumeArg();return t.gullet.macros.set(n,{tokens:i,numArgs:a},!t.settings.strict),{type:"internal",mode:t.mode}}});const Ae={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},ve=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","⌊","⌋","\\lceil","\\rceil","⌈","⌉","<",">","\\langle","⟨","\\rangle","⟩","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","⟮","⟯","\\lmoustache","\\rmoustache","⎰","⎱","\\llbracket","\\rrbracket","⟦","⟦","\\lBrace","\\rBrace","⦃","⦄","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."],Ne=[0,1.2,1.8,2.4,3];function Te(t,r){const n=pe(t);if(n&&s.contains(ve,n.text))return s.contains(["<","\\lt"],n.text)&&(n.text="⟨"),s.contains([">","\\gt"],n.text)&&(n.text="⟩"),n;throw new e(n?`Invalid delimiter '${n.text}' after '${r.funcName}'`:`Invalid delimiter type '${t.type}'`,t)}c({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(e,t)=>{const r=Te(t[0],e);return{type:"delimsizing",mode:e.parser.mode,size:Ae[e.funcName].size,mclass:Ae[e.funcName].mclass,delim:r.text}},mathmlBuilder:e=>{const t=[];"."!==e.delim&&t.push(Q(e.delim,e.mode));const r=new N.MathNode("mo",t);return"mopen"===e.mclass||"mclose"===e.mclass?r.setAttribute("fence","true"):r.setAttribute("fence","false"),r.setAttribute("stretchy","true"),r.setAttribute("symmetric","true"),r.setAttribute("minsize",Ne[e.size]+"em"),r.setAttribute("maxsize",Ne[e.size]+"em"),r}}),c({type:"leftright-right",names:["\\right"],props:{numArgs:1,argTypes:["primitive"]},handler:(t,r)=>{const n=t.parser.gullet.macros.get("\\current@color");if(n&&"string"!=typeof n)throw new e("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:t.parser.mode,delim:Te(r[0],t).text,color:n}}}),c({type:"leftright",names:["\\left"],props:{numArgs:1,argTypes:["primitive"]},handler:(e,t)=>{const r=Te(t[0],e),n=e.parser;++n.leftrightDepth;const o=n.parseExpression(!1);--n.leftrightDepth,n.expect("\\right",!1);const s=le(n.parseFunction(),"leftright-right");return{type:"leftright",mode:n.mode,body:o,left:r.text,right:s.delim,rightColor:s.color}},mathmlBuilder:(e,t)=>{!function(e){if(!e.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}(e);const r=te(e.body,t);if("."!==e.left){const t=new N.MathNode("mo",[Q(e.left,e.mode)]);t.setAttribute("fence","true"),t.setAttribute("form","prefix"),r.unshift(t)}if("."!==e.right){const t=new N.MathNode("mo",[Q(e.right,e.mode)]);t.setAttribute("fence","true"),t.setAttribute("form","postfix"),e.rightColor&&t.setAttribute("mathcolor",e.rightColor),r.push(t)}return ee(r)}}),c({type:"middle",names:["\\middle"],props:{numArgs:1,argTypes:["primitive"]},handler:(t,r)=>{const n=Te(r[0],t);if(!t.parser.leftrightDepth)throw new e("\\middle without preceding \\left",n);return{type:"middle",mode:t.parser.mode,delim:n.text}},mathmlBuilder:(e,t)=>{const r=Q(e.delim,e.mode),n=new N.MathNode("mo",[r]);return n.setAttribute("fence","true"),n.setAttribute("lspace","0.05em"),n.setAttribute("rspace","0.05em"),n}});const qe=(e,t)=>{const r=new N.MathNode(e.label.indexOf("colorbox")>-1?"mpadded":"menclose",[ne(e.body,t)]);switch(e.label){case"\\cancel":r.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":r.setAttribute("notation","downdiagonalstrike");break;case"\\longdiv":r.setAttribute("notation","longdiv");break;case"\\phase":r.setAttribute("notation","phasorangle");break;case"\\sout":r.setAttribute("notation","horizontalstrike");break;case"\\fbox":r.setAttribute("notation","box");break;case"\\angl":r.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":{const t=3;r.setAttribute("width",`+${2*t}pt`),r.setAttribute("height",`+${2*t}pt`),r.setAttribute("lspace",`${t}pt`),r.setAttribute("voffset",`${t}pt`),"\\fcolorbox"===e.label&&r.setAttribute("style","border: 0.06em solid "+String(e.borderColor));break}case"\\xcancel":r.setAttribute("notation","updiagonalstrike downdiagonalstrike")}return e.backgroundColor&&r.setAttribute("mathbackground",e.backgroundColor),r};c({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler({parser:e,funcName:t},r){const n=le(r[0],"color-token").color,o=r[1];return{type:"enclose",mode:e.mode,label:t,backgroundColor:n,body:o}},mathmlBuilder:qe}),c({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler({parser:e,funcName:t},r){const n=le(r[0],"color-token").color,o=le(r[1],"color-token").color,s=r[2];return{type:"enclose",mode:e.mode,label:t,backgroundColor:o,borderColor:n,body:s}},mathmlBuilder:qe}),c({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler:({parser:e},t)=>({type:"enclose",mode:e.mode,label:"\\fbox",body:t[0]})}),c({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase","\\longdiv"],props:{numArgs:1},handler({parser:e,funcName:t},r){const n=r[0];return{type:"enclose",mode:e.mode,label:t,body:n}},mathmlBuilder:qe}),c({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler:({parser:e},t)=>({type:"enclose",mode:e.mode,label:"\\angl",body:t[0]})});const Se={};function Me({type:e,names:t,props:r,handler:n,mathmlBuilder:o}){const s={type:e,numArgs:r.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:n};for(let e=0;e<t.length;++e)Se[t[e]]=s;o&&(l[e]=o)}const Be=0,Oe=1,Ce=2,Ee=3;function Ie(e){const t=[];e.consumeSpaces();let r=e.fetch().text;for(;"\\hline"===r||"\\hdashline"===r;)e.consume(),t.push("\\hdashline"===r),e.consumeSpaces(),r=e.fetch().text;return t}const ze=t=>{if(!t.parser.settings.displayMode)throw new e(`{${t.envName}} can be used only in display mode.`)},$e=(e,t,r)=>{let n;const o=e.tags.shift();if(o){if(!o.body)return n=new N.MathNode("mtd",[]),n.setAttribute("style","padding: 0; min-width:0"),n;n=re(o.body,t),n.classes=["tml-tag"]}else{if("multline"===e.colSeparationType&&(e.leqno&&0!==r||!e.leqno&&r!==e.body.length-1))return n=new N.MathNode("mtd",[]),n.setAttribute("style","padding: 0; min-width:0"),n;n=new N.MathNode("mtext",[],["tml-eqn"])}return n=new N.MathNode("mpadded",[n]),n.setAttribute("style","width:0;"),n.setAttribute("width","0"),e.leqno||n.setAttribute("lspace","-1width"),n=new N.MathNode("mtd",[n]),n.setAttribute("style","padding: 0; min-width:0"),n};function Le(t,{hskipBeforeAndAfter:r,addJot:n,cols:o,arraystretch:s,colSeparationType:a,addEqnNum:i,singleRow:l,maxNumCols:c,leqno:p},m){if(t.gullet.beginGroup(),l||t.gullet.macros.set("\\cr","\\\\\\relax"),i&&(t.gullet.macros.set("\\tag","\\env@tag{\\text{#1}}"),t.gullet.macros.set("\\notag","\\env@notag")),!s){const r=t.gullet.expandMacroAsText("\\arraystretch");if(null==r)s=1;else if(!(s=parseFloat(r))||s<0)throw new e(`Invalid \\arraystretch: ${r}`)}t.gullet.beginGroup();let u=[];const d=[u],h=[],g=[];let b;const f=[];for(f.push(Ie(t));;){let r=t.parseExpression(!1,l?"\\end":"\\\\");if(i&&!b)for(let e=0;e<r.length;e++)if("envTag"===r[e].type||"noTag"===r[e].type){b="envTag"===r[e].type?r.splice(e,1)[0].body.body[0]:{body:null};break}t.gullet.endGroup(),t.gullet.beginGroup(),r={type:"ordgroup",mode:t.mode,body:r},u.push(r);const n=t.fetch().text;if("&"===n){if(c&&u.length===c){if(l||a)throw new e("Too many tab characters: &",t.nextToken);t.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}t.consume()}else{if("\\end"===n){1===u.length&&0===r.body.length&&d.pop(),f.length<d.length+1&&f.push([]);break}if("\\\\"!==n)throw new e("Expected & or \\\\ or \\cr or \\end",t.nextToken);{let e;t.consume()," "!==t.gullet.future().text&&(e=t.parseSizeGroup(!0)),h.push(e?e.value:null),g.push(b),f.push(Ie(t)),u=[],b=null,d.push(u)}}}return t.gullet.endGroup(),t.gullet.endGroup(),g.push(b),{type:"array",mode:t.mode,addJot:n,arraystretch:s,body:d,cols:o,rowGaps:h,hskipBeforeAndAfter:r,hLinesBeforeRow:f,colSeparationType:a,addEqnNum:i,scriptLevel:m,tags:g,leqno:p}}function De(e){return"d"===e.substr(0,1)?"display":"text"}const Fe={c:"center ",l:"left ",r:"right "},Ge=function(e,t){const r=[],n=e.body.length;let o;if(e.addEqnNum){o=new N.MathNode("mtd",[],[]);const t="padding: 0;width: "+("multline"===e.colSeparationType?"7.5%":"50%");o.setAttribute("style",t)}for(let s=0;s<n;s++){const a=e.body[s],i=[],l="text"===e.scriptLevel?Oe:Be;for(let r=0;r<a.length;r++){const o=new N.MathNode("mtd",[ne(a[r],t.withLevel(l))]);if("multline"===e.colSeparationType){const e=0===s?"left":s===n-1?"right":"center";o.setAttribute("columnalign",e)}i.push(o)}if(e.addEqnNum){i.unshift(o),i.push(o);const r=$e(e,t.withLevel(l),s);e.leqno?i.unshift(r):i.push(r)}r.push(new N.MathNode("mtr",i,e.addEqnNum?["tml-tageqn"]:[]))}let a=new N.MathNode("mtable",r);"display"===e.scriptLevel&&a.setAttribute("displaystyle","true");const i=.5===e.arraystretch?.1:.16+e.arraystretch-1+(e.addJot?.09:0);a.setAttribute("rowspacing",s.round(i)+"em"),(e.addEqnNum||"multline"===e.colSeparationType)&&a.setAttribute("width","100%");let l="",c="";if(e.cols&&e.cols.length>0){const t=e.cols;let r="",n=!1,o=0,s=t.length;"separator"===t[0].type&&(l+="top ",o=1),"separator"===t[t.length-1].type&&(l+="bottom ",s-=1);for(let e=o;e<s;e++)"align"===t[e].type?(c+=Fe[t[e].align],n&&(r+="none "),n=!0):"separator"===t[e].type&&n&&(r+="|"===t[e].separator?"solid ":"dashed ",n=!1);e.addEqnNum&&(c="left "+c+"right ",c=e.leqno?"left "+c:c+="right"),a.setAttribute("columnalign",c.trim()),/[sd]/.test(r)&&a.setAttribute("columnlines",r.trim())}switch(e.colSeparationType){case"gather":case"gathered":case"alignedat":case"alignat":case"alignat*":a.setAttribute("columnspacing","0em");break;case"small":a.setAttribute("columnspacing","0.2778em");break;case"CD":a.setAttribute("columnspacing","0.5em");break;case"align":case"align*":{const t=e.cols||[];let r=e.addEqnNum?"0em ":"";for(let e=1;e<t.length;e++)r+=e%2?"0em ":"1em ";e.addEqnNum&&(r+="0em"),a.setAttribute("columnspacing",r.trim());break}default:a.setAttribute("columnspacing","1em")}let p="";const m=e.hLinesBeforeRow;l+=m[0].length>0?"left ":"",l+=m[m.length-1].length>0?"right ":"";for(let e=1;e<m.length-1;e++)p+=0===m[e].length?"none ":m[e][0]?"dashed ":"solid ";return/[sd]/.test(p)&&a.setAttribute("rowlines",p.trim()),""!==l&&(a=new N.MathNode("menclose",[a]),a.setAttribute("notation",l.trim())),e.arraystretch&&e.arraystretch<1&&(a=new N.MathNode("mstyle",[a]),a.setAttribute("scriptlevel","1")),a},Ue=function(t,r){-1===t.envName.indexOf("ed")&&ze(t);const n=[],o=Le(t.parser,{cols:n,addJot:!0,addEqnNum:"align"===t.envName||"alignat"===t.envName,colSeparationType:t.envName,maxNumCols:"split"===t.envName?2:void 0,leqno:t.parser.settings.leqno},"display");let s,a=0;if(r[0]&&"ordgroup"===r[0].type){let e="";for(let t=0;t<r[0].body.length;t++){e+=le(r[0].body[t],"textord").text}s=Number(e),a=2*s}const i=!a;o.body.forEach((function(t){if(i)a<t.length&&(a=t.length);else{const r=t.length/2;if(s<r)throw new e(`Too many math in a row: expected ${s}, but got ${r}`,t[0])}}));for(let e=0;e<a;++e){let t="r";e%2==1&&(t="l"),n[e]={type:"align",align:t}}return o.colSeparationType=i?"align":"alignat",o};Me({type:"array",names:["array","darray"],props:{numArgs:1},handler(t,r){const n=(pe(r[0])?[r[0]]:le(r[0],"ordgroup").body).map((function(t){const r=ce(t).text;if(-1!=="lcr".indexOf(r))return{type:"align",align:r};if("|"===r)return{type:"separator",separator:"|"};if(":"===r)return{type:"separator",separator:":"};throw new e("Unknown column alignment: "+r,t)})),o={cols:n,colSeparationType:"array",hskipBeforeAndAfter:!0,maxNumCols:n.length};return Le(t.parser,o,De(t.envName))},mathmlBuilder:Ge}),Me({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(t){const r={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[t.envName.replace("*","")];let n="c";const o={hskipBeforeAndAfter:!1,colSeparationType:"matrix",cols:[{type:"align",align:n}]};if("*"===t.envName.charAt(t.envName.length-1)){const r=t.parser;if(r.consumeSpaces(),"["===r.fetch().text){if(r.consume(),r.consumeSpaces(),n=r.fetch().text,-1==="lcr".indexOf(n))throw new e("Expected l or c or r",r.nextToken);r.consume(),r.consumeSpaces(),r.expect("]"),r.consume(),o.cols=[{type:"align",align:n}]}}const s=Le(t.parser,o,"text");return s.cols=new Array(s.body[0].length).fill({type:"align",align:n}),r?{type:"leftright",mode:t.mode,body:[s],left:r[0],right:r[1],rightColor:void 0}:s},mathmlBuilder:Ge}),Me({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(e){const t=Le(e.parser,{arraystretch:.5},"script");return t.colSeparationType="small",t},mathmlBuilder:Ge}),Me({type:"array",names:["subarray"],props:{numArgs:1},handler(t,r){const n=(pe(r[0])?[r[0]]:le(r[0],"ordgroup").body).map((function(t){const r=ce(t).text;if(-1!=="lc".indexOf(r))return{type:"align",align:r};throw new e("Unknown column alignment: "+r,t)}));if(n.length>1)throw new e("{subarray} can contain only one column");let o={cols:n,hskipBeforeAndAfter:!1,colSeparationType:"array",arraystretch:.5};if(o=Le(t.parser,o,"script"),o.body.length>0&&o.body[0].length>1)throw new e("{subarray} can contain only one column");return o},mathmlBuilder:Ge}),Me({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(e){const t=Le(e.parser,{arraystretch:1.2,cols:[{type:"align",align:"l"},{type:"align",align:"l"}],colSeparationType:"cases"},De(e.envName));return{type:"leftright",mode:e.mode,body:[t],left:e.envName.indexOf("r")>-1?".":"\\{",right:e.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},mathmlBuilder:Ge}),Me({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:Ue,mathmlBuilder:Ge}),Me({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(e){s.contains(["gather","gather*"],e.envName)&&ze(e);const t={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",addEqnNum:"gather"===e.envName,leqno:e.parser.settings.leqno};return Le(e.parser,t,"display")},mathmlBuilder:Ge}),Me({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:Ue,mathmlBuilder:Ge}),Me({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(e){ze(e);const t={addEqnNum:"equation"===e.envName,singleRow:!0,maxNumCols:1,colSeparationType:"gather",leqno:e.parser.settings.leqno};return Le(e.parser,t,"display")},mathmlBuilder:Ge}),Me({type:"array",names:["multline","multline*"],props:{numArgs:0},handler(e){ze(e);const t={addEqnNum:"multline"===e.envName,maxNumCols:1,colSeparationType:"multline",leqno:e.parser.settings.leqno};return Le(e.parser,t,"display")},mathmlBuilder:Ge}),Me({type:"array",names:["CD"],props:{numArgs:0},handler:t=>(ze(t),function(t){const r=[];for(t.gullet.beginGroup(),t.gullet.macros.set("\\cr","\\\\\\relax"),t.gullet.beginGroup();;){r.push(t.parseExpression(!1,"\\\\")),t.gullet.endGroup(),t.gullet.beginGroup();const n=t.fetch().text;if("&"!==n&&"\\\\"!==n){if("\\end"===n){0===r[r.length-1].length&&r.pop();break}throw new e("Expected \\\\ or \\cr or \\end",t.nextToken)}t.consume()}let n=[];const o=[n];for(let i=0;i<r.length;i++){const l=r[i];let c={type:"styling",body:[],mode:"math",scriptLevel:"display"};for(let r=0;r<l.length;r++)if(ue(l[r])){n.push(c),r+=1;const o=ce(l[r]).text,i=new Array(2);if(i[0]={type:"ordgroup",mode:"math",body:[]},i[1]={type:"ordgroup",mode:"math",body:[]},"=|.".indexOf(o)>-1);else{if(!("<>AV".indexOf(o)>-1))throw new e('Expected one of "<>AV=|." after @.');for(let t=0;t<2;t++){let n=!0;for(let c=r+1;c<l.length;c++){if(a=o,("mathord"===(s=l[c]).type||"atom"===s.type)&&s.text===a){n=!1,r=c;break}if(ue(l[c]))throw new e("Missing a "+o+" character to complete a CD arrow.",l[c]);i[t].body.push(l[c])}if(n)throw new e("Missing a "+o+" character to complete a CD arrow.",l[r])}}const p=de(o,i,t);n.push(p),c={type:"styling",body:[],mode:"math",scriptLevel:"display"}}else c.body.push(l[r]);i%2==0?n.push(c):n.shift(),n=[],o.push(n)}var s,a;return t.gullet.endGroup(),t.gullet.endGroup(),{type:"array",mode:"math",body:o,arraystretch:1,addJot:!0,rowGaps:[null],cols:new Array(o[0].length).fill({type:"align",align:"c"}),colSeparationType:"CD",hLinesBeforeRow:new Array(o.length+1).fill([])}}(t.parser)),mathmlBuilder:Ge}),c({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(t,r){throw new e(`${t.funcName} valid only within array environment`)}});const Pe=Se;function je(e,t){let r;const n=te(e.body,t);return"minner"===e.mclass?N.newDocumentFragment(n):("mord"===e.mclass?e.isCharacterBox?(r=n[0],r.type="mi"):r=new N.MathNode("mi",n):(e.isCharacterBox?(r=n[0],r.type="mo",/[A-Za-z]/.test(e.body[0].text)&&r.setAttribute("mathvariant","italic")):r=new N.MathNode("mo",n),"mbin"===e.mclass?(r.attributes.lspace="0.22em",r.attributes.rspace="0.22em"):"mpunct"===e.mclass?(r.attributes.lspace="0em",r.attributes.rspace="0.17em"):"mopen"!==e.mclass&&"mclose"!==e.mclass||(r.attributes.lspace="0em",r.attributes.rspace="0em")),r)}c({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler({parser:t,funcName:r},n){const o=n[0];if("ordgroup"!==o.type)throw new e("Invalid environment name",o);let s="";for(let e=0;e<o.body.length;++e)s+=le(o.body[e],"textord").text;if("\\begin"===r){if(!Object.prototype.hasOwnProperty.call(Pe,s))throw new e("No such environment: "+s,o);const r=Pe[s],{args:n,optArgs:a}=t.parseArguments("\\begin{"+s+"}",r),i={mode:t.mode,envName:s,parser:t},l=r.handler(i,n,a);t.expect("\\end",!1);const c=t.nextToken,p=le(t.parseFunction(),"environment");if(p.name!==s)throw new e(`Mismatch: \\begin{${s}} matched by \\end{${p.name}}`,c);return l}return{type:"environment",mode:t.mode,name:s,nameGroup:o}}}),c({type:"envTag",names:["\\env@tag"],props:{numArgs:1,argTypes:["math"]},handler:({parser:e},t)=>({type:"envTag",mode:e.mode,body:t[0]}),mathmlBuilder:(e,t)=>new N.MathNode("mrow")}),c({type:"noTag",names:["\\env@notag"],props:{numArgs:0},handler:({parser:e})=>({type:"noTag",mode:e.mode}),mathmlBuilder:(e,t)=>new N.MathNode("mrow")}),c({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler({parser:e,funcName:t},r){const n=r[0];return{type:"mclass",mode:e.mode,mclass:"m"+t.substr(5),body:u(n),isCharacterBox:s.isCharacterBox(n)}},mathmlBuilder:je});const Re=e=>{const t="ordgroup"===e.type&&e.body.length?e.body[0]:e;return"atom"!==t.type||"bin"!==t.family&&"rel"!==t.family?"mord":"m"+t.family};c({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler:({parser:e},t)=>({type:"mclass",mode:e.mode,mclass:Re(t[0]),body:u(t[1]),isCharacterBox:s.isCharacterBox(t[1])})}),c({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler({parser:e,funcName:t},r){const n=r[1],o=r[0],s={type:"op",mode:n.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,stack:!0,suppressBaseShift:"\\stackrel"!==t,body:u(n)};return{type:"supsub",mode:o.mode,base:s,sup:"\\underset"===t?null:o,sub:"\\underset"===t?o:null}},mathmlBuilder:je});const _e=(e,t)=>{const r=e.font,n=t.withFont(r),o=ne(e.body,n);if(0===o.children.length)return o;let s=o.children[0];if("mi"!==s.type)s=o;else{const e=s.attributes.mathvariant||"";for(let t=1;t<o.children.length;t++){if("mi"!==o.children[t].type)return o;if((o.children[t].attributes.mathvariant||"")!==e)return o}for(let e=1;e<o.children.length;e++)s.children.push(o.children[e].children[0]);o.attributes.mathcolor&&(s.attributes.mathcolor=o.attributes.mathcolor)}if(s.attributes.mathvariant&&"normal"===s.attributes.mathvariant){const e=new N.MathNode("mtext",new N.TextNode("​"));return new N.MathNode("mrow",[e,s])}return s},Ve={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};c({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\up@greek","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\oldstylenums","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:({parser:e,funcName:t},r)=>{const n=m(r[0]);let o=t;return o in Ve&&(o=Ve[o]),{type:"font",mode:e.mode,font:o.slice(1),body:n}},mathmlBuilder:_e}),c({type:"mclass",names:["\\bm","\\boldsymbol"],props:{numArgs:1},handler:({parser:e},t)=>{const r=t[0],n=s.isCharacterBox(r),o=Re(r);return"mbin"===o||"mrel"===o?{type:"mclass",mode:e.mode,mclass:o,body:[{type:"font",mode:e.mode,font:"boldsymbol",body:r}],isCharacterBox:n}:{type:"font",mode:e.mode,font:"boldsymbol",body:r}}}),c({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:({parser:e,funcName:t,breakOnTokenText:r},n)=>{const{mode:o}=e,s=e.parseExpression(!0,r);return{type:"font",mode:o,font:`math${t.slice(1)}`,body:{type:"ordgroup",mode:e.mode,body:s}}},mathmlBuilder:_e});const We=["display","text","script","scriptscript"],He={auto:-1,display:0,text:0,script:1,scriptscript:2},Xe=(e,t)=>{const r="auto"===e.scriptLevel?t.incrementLevel():"display"===e.scriptLevel?t.withLevel(Oe):"text"===e.scriptLevel?t.withLevel(Ce):t.withLevel(Ee);let n=new N.MathNode("mfrac",[ne(e.numer,r),ne(e.denom,r)]);if(e.hasBarLine){if(e.barSize){const r=ye(e.barSize,t);n.setAttribute("linethickness",r.number+r.unit)}}else n.setAttribute("linethickness","0px");if(null!=e.leftDelim||null!=e.rightDelim){const t=[];if(null!=e.leftDelim){const r=new N.MathNode("mo",[new N.TextNode(e.leftDelim.replace("\\",""))]);r.setAttribute("fence","true"),t.push(r)}if(t.push(n),null!=e.rightDelim){const r=new N.MathNode("mo",[new N.TextNode(e.rightDelim.replace("\\",""))]);r.setAttribute("fence","true"),t.push(r)}n=ee(t)}return"auto"!==e.scriptLevel&&(n=new N.MathNode("mstyle",[n]),n.setAttribute("displaystyle",String("display"===e.scriptLevel)),n.setAttribute("scriptlevel",He[e.scriptLevel])),n};c({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:({parser:e,funcName:t},r)=>{const n=r[0],o=r[1];let s=!1,a=null,i=null,l="auto";switch(t){case"\\dfrac":case"\\frac":case"\\tfrac":s=!0;break;case"\\\\atopfrac":s=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":a="(",i=")";break;case"\\\\bracefrac":a="\\{",i="\\}";break;case"\\\\brackfrac":a="[",i="]";break;default:throw new Error("Unrecognized genfrac command")}switch(t){case"\\dfrac":case"\\dbinom":l="display";break;case"\\tfrac":case"\\tbinom":l="text"}return{type:"genfrac",mode:e.mode,continued:!1,numer:n,denom:o,hasBarLine:s,leftDelim:a,rightDelim:i,scriptLevel:l,barSize:null}},mathmlBuilder:Xe}),c({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:({parser:e,funcName:t},r)=>{const n=r[0],o=r[1];return{type:"genfrac",mode:e.mode,continued:!0,numer:n,denom:o,hasBarLine:!0,leftDelim:null,rightDelim:null,scriptLevel:"display",barSize:null}}}),c({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler({parser:e,funcName:t,token:r}){let n;switch(t){case"\\over":n="\\frac";break;case"\\choose":n="\\binom";break;case"\\atop":n="\\\\atopfrac";break;case"\\brace":n="\\\\bracefrac";break;case"\\brack":n="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:e.mode,replaceWith:n,token:r}}});const Ze=function(e){let t=null;return e.length>0&&(t=e,t="."===t?null:t),t};c({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler({parser:e},t){const r=t[4],n=t[5],o=m(t[0]),s="atom"===o.type&&"open"===o.family?Ze(o.text):null,a=m(t[1]),i="atom"===a.type&&"close"===a.family?Ze(a.text):null,l=le(t[2],"size");let c,p=null;l.isBlank?c=!0:(p=l.value,c=p.number>0);let u="auto",d=t[3];if("ordgroup"===d.type){if(d.body.length>0){const e=le(d.body[0],"textord");u=We[Number(e.text)]}}else d=le(d,"textord"),u=We[Number(d.text)];return{type:"genfrac",mode:e.mode,numer:r,denom:n,continued:!1,hasBarLine:c,barSize:p,leftDelim:s,rightDelim:i,scriptLevel:u}},mathmlBuilder:Xe}),c({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler:({parser:e,funcName:t,token:r},n)=>({type:"infix",mode:e.mode,replaceWith:"\\\\abovefrac",barSize:le(n[0],"size").value,token:r})}),c({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:({parser:e,funcName:t},r)=>{const n=r[0],o=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e}(le(r[1],"infix").barSize),s=r[2],a=o.number>0;return{type:"genfrac",mode:e.mode,numer:n,denom:s,continued:!1,hasBarLine:a,barSize:o,leftDelim:null,rightDelim:null,scriptLevel:"auto"}},mathmlBuilder:Xe});c({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler:({parser:e,funcName:t},r)=>({type:"horizBrace",mode:e.mode,label:t,isOver:/^\\over/.test(t),base:r[0]}),mathmlBuilder:(e,t)=>{const r=B(e.label);return new N.MathNode(e.isOver?"mover":"munder",[ne(e.base,t),r])}}),c({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:({parser:e},t)=>{const r=t[1],n=le(t[0],"url").url;return e.settings.isTrusted({command:"\\href",url:n})?{type:"href",mode:e.mode,href:n,body:u(r)}:e.formatUnsupportedCmd("\\href")},mathmlBuilder:(e,t)=>{let r=re(e.body,t);return r instanceof A||(r=new A("mrow",[r])),r.setAttribute("href",e.href),r}}),c({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:({parser:e},t)=>{const r=le(t[0],"url").url;if(!e.settings.isTrusted({command:"\\url",url:r}))return e.formatUnsupportedCmd("\\url");const n=[];for(let e=0;e<r.length;e++){let t=r[e];"~"===t&&(t="\\textasciitilde"),n.push({type:"textord",mode:"text",text:t})}const o={type:"text",mode:e.mode,font:"\\texttt",body:n};return{type:"href",mode:e.mode,href:r,body:u(o)}}}),c({type:"html",names:["\\class","\\id","\\style","\\data"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:({parser:t,funcName:r,token:n},o)=>{const s=le(o[0],"raw").string,a=o[1];let i;t.settings.strict&&t.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");const l={};switch(r){case"\\class":l.class=s,i={command:"\\class",class:s};break;case"\\id":l.id=s,i={command:"\\id",id:s};break;case"\\style":l.style=s,i={command:"\\style",style:s};break;case"\\data":{const t=s.split(",");for(let r=0;r<t.length;r++){const n=t[r].split("=");if(2!==n.length)throw new e("Error parsing key-value for \\data");l["data-"+n[0].trim()]=n[1].trim()}i={command:"\\data",attributes:l};break}default:throw new Error("Unrecognized html command")}return t.settings.isTrusted(i)?{type:"html",mode:t.mode,attributes:l,body:u(a)}:t.formatUnsupportedCmd(r)},mathmlBuilder:(e,t)=>{const r=re(e.body,t),n=[];e.attributes.class&&n.push(...e.attributes.class.trim().split(/\s+/)),r.classes=n;for(const t in e.attributes)"class"!==t&&Object.prototype.hasOwnProperty.call(e.attributes,t)&&r.setAttribute(t,e.attributes[t]);return r}});const Ye=function(t){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(t))return{number:+t,unit:"bp"};{const r=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(t);if(!r)throw new e("Invalid size: '"+t+"' in \\includegraphics");const n={number:+(r[1]+r[2]),unit:r[3]};if(!fe(n))throw new e("Invalid unit: '"+n.unit+"' in \\includegraphics.");return n}};c({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:({parser:t},r,n)=>{let o={number:0,unit:"em"},s={number:.9,unit:"em"},a={number:0,unit:"em"},i="";if(n[0]){const t=le(n[0],"raw").string.split(",");for(let r=0;r<t.length;r++){const n=t[r].split("=");if(2===n.length){const t=n[1].trim();switch(n[0].trim()){case"alt":i=t;break;case"width":o=Ye(t);break;case"height":s=Ye(t);break;case"totalheight":a=Ye(t);break;default:throw new e("Invalid key: '"+n[0]+"' in \\includegraphics.")}}}}const l=le(r[0],"url").url;return""===i&&(i=l,i=i.replace(/^.*[\\/]/,""),i=i.substring(0,i.lastIndexOf("."))),t.settings.isTrusted({command:"\\includegraphics",url:l})?{type:"includegraphics",mode:t.mode,alt:i,width:o,height:s,totalheight:a,src:l}:t.formatUnsupportedCmd("\\includegraphics")},mathmlBuilder:(e,t)=>{const r=ye(e.height,t),n={number:0,unit:"em"};e.totalheight.number>0&&e.totalheight.unit===r.unit&&e.totalheight.number>r.number&&(n.number=e.totalheight.number-r.number,n.unit=r.unit);let o=0;e.width.number>0&&(o=ye(e.width,t));const s={height:r.number+n.number+"em"};o.number>0&&(s.width=o.number+o.unit),n.number>0&&(s.verticalAlign=-n.number+n.unit);const a=new x(e.src,e.alt,s);return a.height=r,a.depth=n,new N.MathNode("mtext",[a])}}),c({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler({parser:e,funcName:t},r){const n=le(r[0],"size");if(e.settings.strict){const r="m"===t[1],o="mu"===n.value.unit;r?(o||e.settings.reportNonstrict("mathVsTextUnits",`LaTeX's ${t} supports only mu units, not ${n.value.unit} units`),"math"!==e.mode&&e.settings.reportNonstrict("mathVsTextUnits",`LaTeX's ${t} works only in math mode`)):o&&e.settings.reportNonstrict("mathVsTextUnits",`LaTeX's ${t} doesn't support mu units`)}return{type:"kern",mode:e.mode,dimension:n.value}},mathmlBuilder(e,t){const r=ye(e.dimension,t),n="em"===r.unit?Je(r.number):"";if("text"===e.mode&&n.length>0){const e=new N.TextNode(n);return new N.MathNode("mtext",[e])}{const e=new N.MathNode("mspace");return e.setAttribute("width",r.number+r.unit),e}}});const Je=function(e){return e>=.05555&&e<=.05556?" ":e>=.1666&&e<=.1667?" ":e>=.2222&&e<=.2223?" ":e>=.2777&&e<=.2778?"  ":""},Ke=/[^A-Za-z_0-9-]/g;c({type:"label",names:["\\label"],props:{numArgs:1,argTypes:["raw"]},handler:({parser:e},t)=>({type:"label",mode:e.mode,string:t[0].string.replace(Ke,"")}),mathmlBuilder(e,t){const r=new N.MathNode("mrow",[],["tml-label"]);return e.string.length>0&&r.setAttribute("id",e.string),r}}),c({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:({parser:e,funcName:t},r)=>{const n=r[0];return{type:"lap",mode:e.mode,alignment:t.slice(5),body:n}},mathmlBuilder:(e,t)=>{const r=new N.MathNode("mpadded",[ne(e.body,t)]);if("rlap"!==e.alignment){const t="llap"===e.alignment?"-1":"-0.5";r.setAttribute("lspace",t+"width")}return r.setAttribute("width","0px"),r}}),c({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler({funcName:e,parser:t},r){const n=t.mode;t.switchMode("math");const o="\\("===e?"\\)":"$",s=t.parseExpression(!1,o);return t.expect(o),t.switchMode(n),{type:"styling",mode:t.mode,scriptLevel:"text",body:s}}}),c({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(t,r){throw new e(`Mismatched ${t.funcName}`)}});c({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:({parser:e},t)=>({type:"mathchoice",mode:e.mode,display:u(t[0]),text:u(t[1]),script:u(t[2]),scriptscript:u(t[3])}),mathmlBuilder:(e,t)=>{const r=((e,t)=>{switch(t.level){case Be:return e.display;case Oe:return e.text;case Ce:return e.script;case Ee:return e.scriptscript;default:return e.text}})(e,t);return re(r,t)}});const Qe=(e,t,r)=>{if(!e)return r;const n=ne(e,t);return"mrow"===n.type&&0===n.children.length?r:n};c({type:"multiscript",names:["\\sideset","\\pres@cript"],props:{numArgs:3},handler({parser:t,funcName:r},n){if(0===n[2].body.length)throw new e(r+"cannot parse an empty base.");const o=n[2].body[0];if(t.settings.strict&&"\\sideset"===r&&!o.symbol)throw new e("The base of \\sideset must be a big operator.");if(n[0].body.length>0&&"supsub"!==n[0].body[0].type||n[1].body.length>0&&"supsub"!==n[1].body[0].type)throw new e("\\sideset can parse only subscripts and superscripts in its first two arguments");const s=n[0].body.length>0?n[0].body[0]:null,a=n[1].body.length>0?n[1].body[0]:null;return!s&!a?o:s?{type:"multiscript",mode:t.mode,prescripts:s,postscripts:a,base:o}:{type:"styling",mode:t.mode,scriptLevel:"text",body:[{type:"supsub",mode:t.mode,base:o,sup:a.sup,sub:a.sub}]}},mathmlBuilder(e,t){const r=ne(e.base,t),n=new N.MathNode("mprescripts"),o=new N.MathNode("none");let s=[];const a=Qe(e.prescripts.sub,t,o),i=Qe(e.prescripts.sup,t,o);if(a.setAttribute("style","text-align: left;"),i.setAttribute("style","text-align: left;"),e.postscripts){s=[r,Qe(e.postscripts.sub,t,o),Qe(e.postscripts.sup,t,o),n,a,i]}else s=[r,n,a,i];return new N.MathNode("mmultiscripts",s)}}),c({type:"newExtArrow",names:["\\ext@arrow"],props:{numArgs:4,argTypes:["raw","raw","raw","math"]},handler:({parser:e},t)=>({type:"newExtArrow",mode:e.mode,lspace:s.round(Number(t[0].string.trim())/18),rspace:s.round(Number(t[1].string.trim())/18),charCode:Number(t[2].string.trim()),body:t[3]}),mathmlBuilder(e,t){const r=new N.MathNode("mo",[new N.TextNode(String.fromCodePoint(e.charCode))]);let n;if(r.setAttribute("stretchy","true"),r.setAttribute("minsize","1.75em"),e.body){let o=ne(e.body,t.incrementLevel());o=new N.MathNode("mpadded",[o]),o.setAttribute("width","+"+(e.lspace+e.rspace)+"em"),o.setAttribute("lspace",e.lspace+"em"),n=new N.MathNode("mover",[r,o])}else n=paddedNode(),n=new N.MathNode("mover",[r,n]);return n}}),c({type:"not",names:["\\not"],props:{numArgs:1,primitive:!0,allowedInText:!1},handler({parser:e},t){const r=s.isCharacterBox(t[0]);let n;if(r)n=u(t[0]),"\\"===n[0].text.charAt(0)&&(n[0].text=E.math[n[0].text].replace),n[0].text=n[0].text.slice(0,1)+"̸"+n[0].text.slice(1);else{n=[{type:"textord",mode:"math",text:"̸"},{type:"kern",mode:"math",dimension:{number:-.6,unit:"em"}},t[0]]}return{type:"not",mode:e.mode,body:n,isCharacterBox:r}},mathmlBuilder(e,t){if(e.isCharacterBox){return te(e.body,t)[0]}return re(e.body,t,!0)}});const et=["\\smallint"],tt=["textord","mathord","ordgroup","close","leftright"],rt=(e,t)=>{let r;if(e.symbol)r=new A("mo",[Q(e.name,e.mode)]),s.contains(et,e.name)&&r.setAttribute("largeop","false");else if(e.body)r=new A("mo",te(e.body,t));else if(r=new A("mi",[new v(e.name.slice(1))]),!e.parentIsSupSub){const t=new A("mo",[Q("⁡","text")]);if(e.needsLeadingSpace){const e=new A("mspace");e.setAttribute("width","0.1667em"),r=k([e,r,t])}else r=k([r,t])}return r},nt={"∏":"\\prod","∐":"\\coprod","∑":"\\sum","⋀":"\\bigwedge","⋁":"\\bigvee","⋂":"\\bigcap","⋃":"\\bigcup","⨀":"\\bigodot","⨁":"\\bigoplus","⨂":"\\bigotimes","⨄":"\\biguplus","⨅":"\\bigsqcap","⨆":"\\bigsqcup"};c({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcap","\\bigsqcup","\\smallint","∏","∐","∑","⋀","⋁","⋂","⋃","⨀","⨁","⨂","⨄","⨆"],props:{numArgs:0},handler:({parser:e,funcName:t},r)=>{let n=t;return 1===n.length&&(n=nt[n]),{type:"op",mode:e.mode,limits:!0,parentIsSupSub:!1,symbol:!0,stack:!1,name:n}},mathmlBuilder:rt}),c({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:({parser:e},t)=>{const r=t[0];return{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!1,stack:!1,body:u(r)}},mathmlBuilder:rt});const ot={"∫":"\\int","∬":"\\iint","∭":"\\iiint","∮":"\\oint","∯":"\\oiint","∰":"\\oiiint","∱":"\\intclockwise","∲":"\\varointclockwise","⨌":"\\iiiint","⨍":"\\intbar","⨎":"\\intBar","⨏":"\\fint","⨒":"\\rppolint","⨓":"\\scpolint","⨕":"\\pointint","⨖":"\\sqint","⨗":"\\intlarhk","⨘":"\\intx","⨙":"\\intcap","⨚":"\\intcup"};c({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler({parser:e,funcName:t}){const r=e.prevAtomType;return{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!1,stack:!1,needsLeadingSpace:r.length>0&&s.contains(tt,r),name:t}},mathmlBuilder:rt}),c({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler({parser:e,funcName:t}){const r=e.prevAtomType;return{type:"op",mode:e.mode,limits:!0,parentIsSupSub:!1,symbol:!1,stack:!1,needsLeadingSpace:r.length>0&&s.contains(tt,r),name:t}},mathmlBuilder:rt}),c({type:"op",names:["\\int","\\iint","\\iiint","\\iiiint","\\oint","\\oiint","\\oiiint","\\intclockwise","\\varointclockwise","\\intbar","\\intBar","\\fint","\\rppolint","\\scpolint","\\pointint","\\sqint","\\intlarhk","\\intx","\\intcap","\\intcup","∫","∬","∭","∮","∯","∰","∱","∲","⨌","⨍","⨎","⨏","⨒","⨓","⨕","⨖","⨗","⨘","⨙","⨚"],props:{numArgs:0},handler({parser:e,funcName:t}){let r=t;return 1===r.length&&(r=ot[r]),{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!0,stack:!1,name:r}},mathmlBuilder:rt});c({type:"operatorname",names:["\\operatorname","\\operatorname*"],props:{numArgs:1},handler:({parser:e,funcName:t},r)=>{const n=r[0],o=e.prevAtomType;return{type:"operatorname",mode:e.mode,body:u(n),alwaysHandleSupSub:"\\operatorname*"===t,limits:!1,parentIsSupSub:!1,needsLeadingSpace:o.length>0&&s.contains(tt,o)}},mathmlBuilder:(e,t)=>{let r=te(e.body,t.withFont("mathrm")),n=!0;for(let e=0;e<r.length;e++){const t=r[e];if(t instanceof N.MathNode)switch(t.type){case"mi":case"mn":case"ms":case"mtext":break;case"mspace":if(t.attributes.width){const o=t.attributes.width.replace("em",""),s=Je(Number(o));""===s?n=!1:r[e]=new N.MathNode("mtext",[new N.TextNode(s)])}break;case"mo":{const e=t.children[0];1===t.children.length&&e instanceof N.TextNode?e.text=e.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):n=!1;break}default:n=!1}else n=!1}if(n){const e=r.map((e=>e.toText())).join("");r=[new N.TextNode(e)]}else if(1===r.length&&s.contains(["mover","munder"],r[0].type)&&("mi"===r[0].children[0].type||"mtext"===r[0].children[0].type)){if(r[0].children[0].type="mi",e.parentIsSupSub)return new N.MathNode("mrow",r);{const e=new N.MathNode("mo",[Q("⁡","text")]);return N.newDocumentFragment([r[0],e])}}const o=new N.MathNode("mi",r);if(o.setAttribute("mathvariant","normal"),!e.parentIsSupSub){const t=new N.MathNode("mo",[Q("⁡","text")]);if(e.needsLeadingSpace){const e=new N.MathNode("mspace");return e.setAttribute("width","0.1667em"),N.newDocumentFragment([e,o,t])}return N.newDocumentFragment([o,t])}return o}}),p({type:"ordgroup",mathmlBuilder:(e,t)=>re(e.body,t,!0)}),c({type:"overline",names:["\\overline"],props:{numArgs:1},handler({parser:e},t){const r=t[0];return{type:"overline",mode:e.mode,body:r}},mathmlBuilder(e,t){const r=new N.MathNode("mo",[new N.TextNode("‾")]);r.setAttribute("stretchy","true");const n=new N.MathNode("mover",[ne(e.body,t),r]);return n.setAttribute("accent","true"),n}}),c({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:({parser:e},t)=>{const r=t[0];return{type:"phantom",mode:e.mode,body:u(r)}},mathmlBuilder:(e,t)=>{const r=te(e.body,t);return new N.MathNode("mphantom",r)}}),c({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:({parser:e},t)=>{const r=t[0];return{type:"hphantom",mode:e.mode,body:r}},mathmlBuilder:(e,t)=>{const r=te(u(e.body),t),n=new N.MathNode("mphantom",r),o=new N.MathNode("mpadded",[n]);return o.setAttribute("height","0px"),o.setAttribute("depth","0px"),o}}),c({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:({parser:e},t)=>{const r=t[0];return{type:"vphantom",mode:e.mode,body:r}},mathmlBuilder:(e,t)=>{const r=te(u(e.body),t),n=new N.MathNode("mphantom",r),o=new N.MathNode("mpadded",[n]);return o.setAttribute("width","0px"),o}});const st=e=>e>=0?"+":"-",at=(e,t)=>{const r=t.withLevel(Oe),n=new N.MathNode("mpadded",[ne(e.body,r)]),o=ye(e.dy,t);n.setAttribute("voffset",o.number+o.unit);const s=Math.abs(o.number);return n.setAttribute("height",st(o.number)+s+o.unit),n.setAttribute("depth",st(-o.number)+s+o.unit),n};c({type:"raise",names:["\\raise","\\lower"],props:{numArgs:2,argTypes:["size","primitive"],primitive:!0},handler({parser:e,funcName:t},r){const n=le(r[0],"size").value;"\\lower"===t&&(n.number*=-1);const o=r[1];return{type:"raise",mode:e.mode,dy:n,body:o}},mathmlBuilder:at}),c({type:"raise",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler({parser:e,funcName:t},r){const n=le(r[0],"size").value,o=r[1];return{type:"raise",mode:e.mode,dy:n,body:o}},mathmlBuilder:at}),c({type:"ref",names:["\\ref","\\eqref"],props:{numArgs:1,argTypes:["raw"]},handler:({parser:e,funcName:t},r)=>({type:"ref",mode:e.mode,funcName:t,string:r[0].string.replace(Ke,"")}),mathmlBuilder(e,t){const r="\\ref"===e.funcName?["tml-ref"]:["tml-ref","tml-eqref"],n=new N.MathNode("mtext",[new N.TextNode("")],r);return n.setAttribute("href","#"+e.string),n}}),c({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,argTypes:["size","size","size"]},handler({parser:e},t,r){const n=r[0],o=le(t[0],"size"),s=le(t[1],"size");return{type:"rule",mode:e.mode,shift:n&&le(n,"size").value,width:o.value,height:s.value}},mathmlBuilder(e,t){const r=ye(e.width,t),n=ye(e.height,t),o=e.shift?ye(e.shift,t):{number:0,unit:"em"},s=t.color&&t.getColor()||"black",a=new N.MathNode("mspace");a.setAttribute("mathbackground",s),a.setAttribute("width",r.number+r.unit),a.setAttribute("height",n.number+n.unit);const i=new N.MathNode("mpadded",[a]);return o.number>=0?i.setAttribute("height","+"+o.number+o.unit):(i.setAttribute("height",o.number+o.unit),i.setAttribute("depth","+"+-o.number+o.unit)),i.setAttribute("voffset",o.number+o.unit),i}});const it={"\\tiny":.5,"\\sixptsize":.6,"\\Tiny":.6,"\\scriptsize":.7,"\\footnotesize":.8,"\\small":.9,"\\normalsize":1,"\\large":1.2,"\\Large":1.44,"\\LARGE":1.728,"\\huge":2.074,"\\Huge":2.488};c({type:"sizing",names:["\\tiny","\\sixptsize","\\Tiny","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],props:{numArgs:0,allowedInText:!0},handler:({breakOnTokenText:e,funcName:t,parser:r},n)=>{const o=r.parseExpression(!1,e);return{type:"sizing",mode:r.mode,funcName:t,body:o}},mathmlBuilder:(e,t)=>{const r=te(e.body,t),n=new N.MathNode("mstyle",r);return n.setAttribute("mathsize",it[e.funcName]+"em"),n}}),c({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:({parser:e},t,r)=>{let n=!1,o=!1;const s=r[0]&&le(r[0],"ordgroup");if(s){let e="";for(let t=0;t<s.body.length;++t){if(e=s.body[t].text,"t"===e)n=!0;else{if("b"!==e){n=!1,o=!1;break}o=!0}}}else n=!0,o=!0;const a=t[0];return{type:"smash",mode:e.mode,body:a,smashHeight:n,smashDepth:o}},mathmlBuilder:(e,t)=>{const r=new N.MathNode("mpadded",[ne(e.body,t)]);return e.smashHeight&&r.setAttribute("height","0px"),e.smashDepth&&r.setAttribute("depth","0px"),r}}),c({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler({parser:e},t,r){const n=r[0],o=t[0];return{type:"sqrt",mode:e.mode,body:o,index:n}},mathmlBuilder(e,t){const{body:r,index:n}=e;return n?new N.MathNode("mroot",[ne(r,t),ne(n,t.incrementLevel())]):new N.MathNode("msqrt",[ne(r,t)])}});const lt={display:0,text:1,script:2,scriptscript:3};c({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler({breakOnTokenText:e,funcName:t,parser:r},n){const o=r.parseExpression(!0,e),s=t.slice(1,t.length-5);return{type:"styling",mode:r.mode,scriptLevel:s,body:o}},mathmlBuilder(e,t){const r=t.withLevel(lt[e.scriptLevel]),n=te(e.body,r),o=new N.MathNode("mstyle",n),s={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]}[e.scriptLevel];return o.setAttribute("scriptlevel",s[0]),o.setAttribute("displaystyle",s[1]),o}}),p({type:"supsub",mathmlBuilder(e,t){let r,n,o=!1,s=!1,a=!1;e.base&&"horizBrace"===e.base.type&&(n=!!e.sup,n===e.base.isOver&&(o=!0,r=e.base.isOver)),!e.base||e.base.stack||"op"!==e.base.type&&"operatorname"!==e.base.type||(e.base.parentIsSupSub=!0,s=!e.base.symbol,a=e.base.needsLeadingSpace);const i=e.base&&e.base.stack?[ne(e.base.body[0],t)]:[ne(e.base,t)],l=t.incrementLevel();let c;if(e.sub&&i.push(ne(e.sub,l)),e.sup&&i.push(ne(e.sup,l)),o)c=r?"mover":"munder";else if(e.sub)if(e.sup){const r=e.base;c=r&&"op"===r.type&&r.limits&&t.level===Be||r&&"operatorname"===r.type&&r.alwaysHandleSupSub&&(t.level===Be||r.limits)?"munderover":"msubsup"}else{const r=e.base;c=r&&"op"===r.type&&r.limits&&(t.level===Be||r.alwaysHandleSupSub)||r&&"operatorname"===r.type&&r.alwaysHandleSupSub&&(r.limits||t.level===Be)?"munder":"msub"}else{const r=e.base;c=r&&"op"===r.type&&r.limits&&(t.level===Be||r.alwaysHandleSupSub)||r&&"operatorname"===r.type&&r.alwaysHandleSupSub&&(r.limits||t.level===Be)?"mover":"msup"}let p=new N.MathNode(c,i);if(s){const e=new N.MathNode("mo",[Q("⁡","text")]);if(a){const t=new N.MathNode("mspace");t.setAttribute("width","0.1667em"),p=N.newDocumentFragment([t,p,e])}else p=N.newDocumentFragment([p,e])}return p}});const ct={mathbf:"bold",mathrm:"normal",textit:"italic",mathit:"italic",mathnormal:"italic",mathbb:"double-struck",mathcal:"script",mathfrak:"fraktur",mathscr:"script",mathsf:"sans-serif",mathtt:"monospace",oldstylenums:"oldstylenums"},pt=function(e,t){if("texttt"===t.fontFamily)return"monospace";if("textsc"===t.fontFamily)return"normal";if("textsf"===t.fontFamily)return"textit"===t.fontShape&&"textbf"===t.fontWeight?"sans-serif-bold-italic":"textit"===t.fontShape?"sans-serif-italic":"textbf"===t.fontWeight?"bold-sans-serif":"sans-serif";if("textit"===t.fontShape&&"textbf"===t.fontWeight)return"bold-italic";if("textit"===t.fontShape)return"italic";if("textbf"===t.fontWeight)return"bold";const r=t.font;if(!r||"mathnormal"===r)return null;const n=e.mode;switch(r){case"mathit":return"italic";case"mathrm":{const t=e.text.codePointAt(0);return 939<t&&t<975?"lowerCaseGreekItalic":"normal"}case"greekItalic":return"greekItalic";case"up@greek":return"normal";case"boldsymbol":case"mathboldsymbol":return"textord"===e.type?"bold":"bold-italic";case"mathbf":return"bold";case"mathbb":return"double-struck";case"mathfrak":return"fraktur";case"mathscr":case"mathcal":return"script";case"mathsf":return"sans-serif";case"mathtt":return"monospace";case"oldstylenums":return"oldstylenums"}let o=e.text;return E[n][o]&&E[n][o].replace&&(o=E[n][o].replace),Object.prototype.hasOwnProperty.call(ct,r)?ct[r]:null};p({type:"atom",mathmlBuilder(e,t){const r=new N.MathNode("mo",[Q(e.text,e.mode)]);if("bin"===e.family){const n=pt(e,t);"bold-italic"===n&&r.setAttribute("mathvariant",n)}else"punct"===e.family?r.setAttribute("separator","true"):"open"!==e.family&&"close"!==e.family&&"rel"!==e.family||(r.setAttribute("stretchy","false"),"open"===e.family?r.setAttribute("form","prefix"):"close"===e.family&&r.setAttribute("form","postfix"));return r}});const mt={mi:"italic",mn:"normal",mtext:"normal"},ut=/^\d[\d.]*$/,dt={a:"ᴀ",b:"ʙ",c:"ᴄ",d:"ᴅ",e:"ᴇ",f:"ꜰ",g:"ɢ",h:"ʜ",i:"ɪ",j:"ᴊ",k:"ᴋ",l:"ʟ",m:"ᴍ",n:"ɴ",o:"ᴏ",p:"ᴘ",q:"ǫ",r:"ʀ",s:"s",t:"ᴛ",u:"ᴜ",v:"ᴠ",w:"ᴡ",x:"x",y:"ʏ",z:"ᴢ"};p({type:"mathord",mathmlBuilder(e,t){const r=pt(e,t)||"italic",n=Q(e.text,e.mode,t);if("script"===r&&"mathscr"===t.font){const e=new y(["script"],[n]);return new N.MathNode("mi",[e])}const o=new N.MathNode("mi",[n]);return"lowerCaseGreekItalic"===r?o.setAttribute("mathvariant","italic"):r!==mt[o.type]&&o.setAttribute("mathvariant",r),o}}),p({type:"textord",mathmlBuilder(e,t){let r=e.text;const n=r.codePointAt(0);"textsc"===t.fontFamily&&96<n&&n<123&&(r=dt[r]);const o=Q(r,e.mode,t),s=pt(e,t)||"normal";let a;if("text"===e.mode)a=new N.MathNode("mtext",[o]);else if(ut.test(e.text))if("oldstylenums"===s){const e=new y(["oldstylenums"],[o]);a=new N.MathNode("mn",[e])}else a=new N.MathNode("mn",[o]);else a="\\prime"===e.text?new N.MathNode("mo",[o]):new N.MathNode("mi",[o]);return s!==mt[a.type]&&a.setAttribute("mathvariant",s),a}});const ht={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},gt={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};p({type:"spacing",mathmlBuilder(t,r){let n;if(Object.prototype.hasOwnProperty.call(gt,t.text))n=new N.MathNode("mtext",[new N.TextNode(" ")]),"nobreak"===gt[t.text].className&&n.setAttribute("linebreak","nobreak");else{if(!Object.prototype.hasOwnProperty.call(ht,t.text))throw new e(`Unknown type of space "${t.text}"`);n=new N.MathNode("mo"),"\\nobreak"===t.text&&n.setAttribute("linebreak","nobreak")}return n}}),p({type:"tag"});const bt={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm","\\textsc":"textsc"},ft={"\\textbf":"textbf","\\textmd":"textmd"},yt={"\\textit":"textit","\\textup":"textup"};c({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textsc","\\textbf","\\textmd","\\textit","\\textup"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler({parser:e,funcName:t},r){const n=r[0];return{type:"text",mode:e.mode,body:u(n),font:t}},mathmlBuilder(e,t){const r=((e,t)=>{const r=e.font;return r?bt[r]?t.withTextFontFamily(bt[r]):ft[r]?t.withTextFontWeight(ft[r]):t.withTextFontShape(yt[r]):t})(e,t.withLevel(Oe)),n=re(e.body,r);if("mrow"!==n.type)return n;if(0===n.children.length)return n;const o=n.children[0];if(!o.attributes||"mtext"!==o.type)return n;const s=o.attributes.mathvariant||"";for(let e=1;e<n.children.length;e++){if((n.children[e].attributes.mathvariant||"")!==s||"mtext"!==n.children[e].type)return n}for(let e=1;e<n.children.length;e++)o.children.push(n.children[e].children[0]);return o}}),c({type:"tip",names:["\\mathtip"],props:{numArgs:2},handler:({parser:e},t)=>({type:"tip",mode:e.mode,body:t[0],tip:t[1]}),mathmlBuilder:(e,t)=>{const r=ne(e.body,t),n=ne(e.tip,t),o=new N.MathNode("maction",[r,n],["tml-tip"]);return o.setAttribute("actiontype","tooltip"),o}}),c({type:"tip",names:["\\texttip"],props:{numArgs:2,argTypes:["math","text"]},handler:({parser:e},t)=>({type:"tip",mode:e.mode,body:t[0],tip:t[1]}),mathmlBuilder:(e,t)=>{const r=ne(e.body,t),n=ne(e.tip,t);let o="";if("mtext"===n.type)o=n.children[0].text;else for(const e of n.children)o+=e.children[0].text;return r.setAttribute("title",o),r}}),p({type:"toggle",mathmlBuilder(e,t){const r=te(e.body,t),n=new N.MathNode("maction",r,["tml-toggle"]);return n.setAttribute("actiontype","toggle"),n}}),c({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler:({parser:e},t)=>({type:"underline",mode:e.mode,body:t[0]}),mathmlBuilder(e,t){const r=new N.MathNode("mo",[new N.TextNode("‾")]);r.setAttribute("stretchy","true");const n=new N.MathNode("munder",[ne(e.body,t),r]);return n.setAttribute("accentunder","true"),n}}),c({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["math"],allowedInText:!1},handler:({parser:e},t)=>({type:"vcenter",mode:e.mode,body:t[0]}),mathmlBuilder:(e,t)=>new N.MathNode("mpadded",[ne(e.body,t)],["vcenter"])}),c({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(t,r,n){throw new e("\\verb ended by end of line instead of matching delimiter")},mathmlBuilder(e,t){const r=new N.TextNode(wt(e)),n=new N.MathNode("mtext",[r]);return n.setAttribute("mathvariant","monospace"),n}});const wt=e=>e.body.replace(/ /g,e.star?"␣":" "),xt=i;class kt{constructor(e,t,r){this.lexer=e,this.start=t,this.end=r}static range(e,t){return t?e&&e.loc&&t.loc&&e.loc.lexer===t.loc.lexer?new kt(e.loc.lexer,e.loc.start,t.loc.end):null:e&&e.loc}}class At{constructor(e,t){this.text=e,this.loc=t}range(e,t){return new At(t,kt.range(this,e))}}const vt=new RegExp("^(\\\\[a-zA-Z@]+)[ \r\n\t]*$"),Nt=new RegExp("[̀-ͯ]+$"),Tt="([ \r\n\t]+)|\\\\(\n|[ \r\t]+\n?)[ \r\t]*|(\\d[\\d.]*|[!-\\[\\]-‧‪-퟿豈-￿][̀-ͯ]*|[\ud800-\udbff][\udc00-\udfff][̀-ͯ]*|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5|\\\\operatorname\\*|\\\\[a-zA-Z@]+[ \r\n\t]*|\\\\[^\ud800-\udfff])";class qt{constructor(e,t){this.input=e,this.settings=t,this.tokenRegex=new RegExp(Tt.replace("\\d[\\d.]*|",t.strict?"":"\\d[\\d.]*|"),"g"),this.catcodes={"%":14}}setCatcode(e,t){this.catcodes[e]=t}lex(){const t=this.input,r=this.tokenRegex.lastIndex;if(r===t.length)return new At("EOF",new kt(this,r,r));const n=this.tokenRegex.exec(t);if(null===n||n.index!==r)throw new e(`Unexpected character: '${t[r]}'`,new At(t[r],new kt(this,r,r+1)));let o=n[3]||(n[2]?"\\ ":" ");if(14===this.catcodes[o]){const e=t.indexOf("\n",this.tokenRegex.lastIndex);return-1===e?(this.tokenRegex.lastIndex=t.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=e+1,this.lex()}const s=o.match(vt);return s&&(o=s[1]),new At(o,new kt(this,r,this.tokenRegex.lastIndex))}}class St{constructor(e={},t={}){this.current=t,this.builtins=e,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(0===this.undefStack.length)throw new e("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");const t=this.undefStack.pop();for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(void 0===t[e]?delete this.current[e]:this.current[e]=t[e])}has(e){return Object.prototype.hasOwnProperty.call(this.current,e)||Object.prototype.hasOwnProperty.call(this.builtins,e)}get(e){return Object.prototype.hasOwnProperty.call(this.current,e)?this.current[e]:this.builtins[e]}set(e,t,r=!1){if(r){for(let t=0;t<this.undefStack.length;t++)delete this.undefStack[t][e];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][e]=t)}else{const t=this.undefStack[this.undefStack.length-1];t&&!Object.prototype.hasOwnProperty.call(t,e)&&(t[e]=this.current[e])}this.current[e]=t}}const Mt={};function Bt(e,t){Mt[e]=t}Bt("\\noexpand",(function(e){const t=e.popToken();return e.isExpandable(t.text)&&(t.noexpand=!0,t.treatAsRelax=!0),{tokens:[t],numArgs:0}})),Bt("\\expandafter",(function(e){const t=e.popToken();return e.expandOnce(!0),{tokens:[t],numArgs:0}})),Bt("\\@firstoftwo",(function(e){return{tokens:e.consumeArgs(2)[0],numArgs:0}})),Bt("\\@secondoftwo",(function(e){return{tokens:e.consumeArgs(2)[1],numArgs:0}})),Bt("\\@ifnextchar",(function(e){const t=e.consumeArgs(3);e.consumeSpaces();const r=e.future();return 1===t[0].length&&t[0][0].text===r.text?{tokens:t[1],numArgs:0}:{tokens:t[2],numArgs:0}})),Bt("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}"),Bt("\\TextOrMath",(function(e){const t=e.consumeArgs(2);return"text"===e.mode?{tokens:t[0],numArgs:0}:{tokens:t[1],numArgs:0}}));const Ot=e=>{let t="";for(let r=e.length-1;r>-1;r--)t+=e[r].text;return t},Ct={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15},Et=e=>{const t=e.future().text;return"EOF"===t?[null,""]:[Ct[t.charAt(0)],t]},It=(e,t,r)=>{for(let n=1;n<t.length;n++){e*=r,e+=Ct[t.charAt(n)]}return e};Bt("\\char",(function(t){let r,n=t.popToken(),o="";if("'"===n.text)r=8,n=t.popToken();else if('"'===n.text)r=16,n=t.popToken();else if("`"===n.text)if(n=t.popToken(),"\\"===n.text[0])o=n.text.charCodeAt(1);else{if("EOF"===n.text)throw new e("\\char` missing argument");o=n.text.charCodeAt(0)}else r=10;if(r){let s,a=n.text;if(o=Ct[a.charAt(0)],null==o||o>=r)throw new e(`Invalid base-${r} digit ${n.text}`);for(o=It(o,a,r),[s,a]=Et(t);null!=s&&s<r;)o*=r,o+=s,o=It(o,a,r),t.popToken(),[s,a]=Et(t)}return`\\@char{${o}}`})),Bt("\\hbox","\\text{#1}"),Bt("\\bgroup","{"),Bt("\\egroup","}"),Bt("\\lq","`"),Bt("\\rq","'"),Bt("\\aa","\\r a"),Bt("\\AA","\\r A"),Bt("\\Bbbk","\\Bbb{k}"),Bt("\\llap","\\mathllap{\\textrm{#1}}"),Bt("\\rlap","\\mathrlap{\\textrm{#1}}"),Bt("\\clap","\\mathclap{\\textrm{#1}}"),Bt("\\mathstrut","\\vphantom{(}"),Bt("\\underbar","\\underline{\\text{#1}}"),Bt("\\vdots","\\mathord{\\varvdots\\rule{0pt}{15pt}}"),Bt("⋮","\\vdots"),Bt("\\substack","\\begin{subarray}{c}#1\\end{subarray}"),Bt("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu"),Bt("\\boxed","\\fbox{$\\displaystyle{#1}$}"),Bt("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;"),Bt("\\implies","\\DOTSB\\;\\Longrightarrow\\;"),Bt("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");const zt={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcap":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};Bt("\\dots",(function(e){let t="\\dotso";const r=e.expandAfterFuture().text;return r in zt?t=zt[r]:("\\not"===r.substr(0,4)||r in E.math&&s.contains(["bin","rel"],E.math[r].group))&&(t="\\dotsb"),t}));const $t={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};Bt("\\dotso",(function(e){return e.future().text in $t?"\\ldots\\,":"\\ldots"})),Bt("\\dotsc",(function(e){const t=e.future().text;return t in $t&&","!==t?"\\ldots\\,":"\\ldots"})),Bt("\\cdots",(function(e){return e.future().text in $t?"\\@cdots\\,":"\\@cdots"})),Bt("\\dotsb","\\cdots"),Bt("\\dotsm","\\cdots"),Bt("\\dotsi","\\!\\cdots"),Bt("\\idotsint","\\dotsi"),Bt("\\dotsx","\\ldots\\,"),Bt("\\DOTSI","\\relax"),Bt("\\DOTSB","\\relax"),Bt("\\DOTSX","\\relax"),Bt("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax"),Bt("\\,","\\tmspace+{3mu}{.1667em}"),Bt("\\thinspace","\\,"),Bt("\\>","\\mskip{4mu}"),Bt("\\:","\\tmspace+{4mu}{.2222em}"),Bt("\\medspace","\\:"),Bt("\\;","\\tmspace+{5mu}{.2777em}"),Bt("\\thickspace","\\;"),Bt("\\!","\\tmspace-{3mu}{.1667em}"),Bt("\\negthinspace","\\!"),Bt("\\negmedspace","\\tmspace-{4mu}{.2222em}"),Bt("\\negthickspace","\\tmspace-{5mu}{.277em}"),Bt("\\enspace","\\kern.5em "),Bt("\\enskip","\\hskip.5em\\relax"),Bt("\\quad","\\hskip1em\\relax"),Bt("\\qquad","\\hskip2em\\relax"),Bt("\\tag","\\@ifstar\\tag@literal\\tag@paren"),Bt("\\tag@paren","\\tag@literal{({#1})}"),Bt("\\tag@literal",(t=>{if(t.macros.get("\\df@tag"))throw new e("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"})),Bt("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}"),Bt("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)"),Bt("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}"),Bt("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1"),Bt("\\pmb","\\mathbf{#1}"),Bt("\\newline","\\\\\\relax"),Bt("\\TeX","\\textrm{T}\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125em\\textrm{X}"),Bt("\\LaTeX","\\textrm{L}\\kern-.35em\\raisebox{0.2em}{\\scriptstyle A}\\kern-.15em\\TeX"),Bt("\\Temml","\\textrm{T}\\kern-0.2em\\lower{0.2em}\\textrm{E}\\kern-0.08em{\\textrm{M}\\kern-0.08em\\raise{0.2em}\\textrm{M}\\kern-0.08em\\textrm{L}}"),Bt("\\hspace","\\@ifstar\\@hspacer\\@hspace"),Bt("\\@hspace","\\hskip #1\\relax"),Bt("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax"),Bt("\\prescript","\\pres@cript{_{#1}^{#2}}{}{#3}"),Bt("\\ordinarycolon",":"),Bt("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}"),Bt("\\coloneq",'\\mathop{\\char"3a\\char"2212}'),Bt("\\Coloneq",'\\mathop{\\char"2237\\char"2212}'),Bt("\\Eqqcolon",'\\mathop{\\char"3d\\char"2237}'),Bt("\\Eqcolon",'\\mathop{\\char"2212\\char"2237}'),Bt("\\colonapprox",'\\mathop{\\char"3a\\char"2248}'),Bt("\\Colonapprox",'\\mathop{\\char"2237\\char"2248}'),Bt("\\colonsim",'\\mathop{\\char"3a\\char"223c}'),Bt("\\Colonsim",'\\mathop{\\char"2237\\char"223c}'),Bt("\\ratio","\\vcentcolon"),Bt("\\coloncolon","\\dblcolon"),Bt("\\colonequals","\\coloneqq"),Bt("\\coloncolonequals","\\Coloneqq"),Bt("\\equalscolon","\\eqqcolon"),Bt("\\equalscoloncolon","\\Eqqcolon"),Bt("\\colonminus","\\coloneq"),Bt("\\coloncolonminus","\\Coloneq"),Bt("\\minuscolon","\\eqcolon"),Bt("\\minuscoloncolon","\\Eqcolon"),Bt("\\coloncolonapprox","\\Colonapprox"),Bt("\\coloncolonsim","\\Colonsim"),Bt("\\notni","\\mathrel{\\char`∌}"),Bt("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}"),Bt("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}"),Bt("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}"),Bt("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}"),Bt("\\varlimsup","\\DOTSB\\operatorname*{\\overline{\\text{lim}}}"),Bt("\\varliminf","\\DOTSB\\operatorname*{\\underline{\\text{lim}}}"),Bt("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{\\text{lim}}}"),Bt("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{\\text{lim}}}"),Bt("\\argmin","\\DOTSB\\operatorname*{arg\\,min}"),Bt("\\argmax","\\DOTSB\\operatorname*{arg\\,max}"),Bt("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits"),Bt("\\bra","\\mathinner{\\langle{#1}|}"),Bt("\\ket","\\mathinner{|{#1}\\rangle}"),Bt("\\braket","\\mathinner{\\langle{#1}\\rangle}"),Bt("\\Bra","\\left\\langle#1\\right|"),Bt("\\Ket","\\left|#1\\right\\rangle"),Bt("\\angln","{\\angl n}"),Bt("\\newextarrow",(function(t){const r=t.consumeArgs(3),n=r[0][0].text,o=Ot(r[1]).split(",");if(2!==o.length||isNaN(o[0]||isNaN(o[1])))throw new e("Invalid lspace,rspace in \\newextarrow.");const s=Ot(r[2]);if(isNaN(s))throw new e("Invalid Unicode character code in \\newextarrow.");return Bt(n,`\\ext@arrow{${o[0]}}{${o[1]}}{${s}}{#1}`),""})),Bt("\\upalpha","\\up@greek{\\alpha}"),Bt("\\upbeta","\\up@greek{\\beta}"),Bt("\\upgamma","\\up@greek{\\gamma}"),Bt("\\updelta","\\up@greek{\\delta}"),Bt("\\upepsilon","\\up@greek{\\epsilon}"),Bt("\\upzeta","\\up@greek{\\zeta}"),Bt("\\upeta","\\up@greek{\\eta}"),Bt("\\uptheta","\\up@greek{\\theta}"),Bt("\\upiota","\\up@greek{\\iota}"),Bt("\\upkappa","\\up@greek{\\kappa}"),Bt("\\uplambda","\\up@greek{\\lambda}"),Bt("\\upmu","\\up@greek{\\mu}"),Bt("\\upnu","\\up@greek{\\nu}"),Bt("\\upxi","\\up@greek{\\xi}"),Bt("\\upomicron","\\up@greek{\\omicron}"),Bt("\\uppi","\\up@greek{\\pi}"),Bt("\\upalpha","\\up@greek{\\alpha}"),Bt("\\uprho","\\up@greek{\\rho}"),Bt("\\upsigma","\\up@greek{\\sigma}"),Bt("\\uptau","\\up@greek{\\tau}"),Bt("\\upupsilon","\\up@greek{\\upsilon}"),Bt("\\upphi","\\up@greek{\\phi}"),Bt("\\upchi","\\up@greek{\\chi}"),Bt("\\uppsi","\\up@greek{\\psi}"),Bt("\\upomega","\\up@greek{\\omega}"),Bt("\\standardstate","{\\tiny\\char`⦵}");const Lt={"\\relax":!0,"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class Dt{constructor(e,t,r){this.settings=t,this.expansionCount=0,this.feed(e),this.macros=new St(Mt,t.macros),this.mode=r,this.stack=[]}feed(e){this.lexer=new qt(e,this.settings)}switchMode(e){this.mode=e}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}future(){return 0===this.stack.length&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(e){this.stack.push(e)}pushTokens(e){this.stack.push(...e)}scanArgument(e){let t,r,n;if(e){if(this.consumeSpaces(),"["!==this.future().text)return null;t=this.popToken(),({tokens:n,end:r}=this.consumeArg(["]"]))}else({tokens:n,start:t,end:r}=this.consumeArg());return this.pushToken(new At("EOF",r.loc)),this.pushTokens(n),t.range(r,"")}consumeSpaces(){for(;;){if(" "!==this.future().text)break;this.stack.pop()}}consumeArg(t){const r=[],n=t&&t.length>0;n||this.consumeSpaces();const o=this.future();let s,a=0,i=0;do{if(s=this.popToken(),r.push(s),"{"===s.text)++a;else if("}"===s.text){if(--a,-1===a)throw new e("Extra }",s)}else if("EOF"===s.text)throw new e("Unexpected end of input in a macro argument, expected '"+(t&&n?t[i]:"}")+"'",s);if(t&&n)if((0===a||1===a&&"{"===t[i])&&s.text===t[i]){if(++i,i===t.length){r.splice(-i,i);break}}else i=0}while(0!==a||n);return"{"===o.text&&"}"===r[r.length-1].text&&(r.pop(),r.shift()),r.reverse(),{tokens:r,start:o,end:s}}consumeArgs(t,r){if(r){if(r.length!==t+1)throw new e("The length of delimiters doesn't match the number of args!");const n=r[0];for(let t=0;t<n.length;t++){const r=this.popToken();if(n[t]!==r.text)throw new e("Use of the macro doesn't match its definition",r)}}const n=[];for(let e=0;e<t;e++)n.push(this.consumeArg(r&&r[e+1]).tokens);return n}expandOnce(t){const r=this.popToken(),n=r.text,o=r.noexpand?null:this._getExpansion(n);if(null==o||t&&o.unexpandable){if(t&&null==o&&"\\"===n[0]&&!this.isDefined(n))throw new e("Undefined control sequence: "+n);return this.pushToken(r),r}if(this.expansionCount++,this.expansionCount>this.settings.maxExpand)throw new e("Too many expansions: infinite loop or need to increase maxExpand setting");let s=o.tokens;const a=this.consumeArgs(o.numArgs,o.delimiters);if(o.numArgs){s=s.slice();for(let t=s.length-1;t>=0;--t){let r=s[t];if("#"===r.text){if(0===t)throw new e("Incomplete placeholder at end of macro body",r);if(r=s[--t],"#"===r.text)s.splice(t+1,1);else{if(!/^[1-9]$/.test(r.text))throw new e("Not a valid argument number",r);s.splice(t,2,...a[+r.text-1])}}}}return this.pushTokens(s),s}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;){const e=this.expandOnce();if(e instanceof At){if("\\relax"!==e.text&&!e.treatAsRelax)return this.stack.pop();this.stack.pop()}}throw new Error}expandMacro(e){return this.macros.has(e)?this.expandTokens([new At(e)]):void 0}expandTokens(e){const t=[],r=this.stack.length;for(this.pushTokens(e);this.stack.length>r;){const e=this.expandOnce(!0);e instanceof At&&(e.treatAsRelax&&(e.noexpand=!1,e.treatAsRelax=!1),t.push(this.stack.pop()))}return t}expandMacroAsText(e){const t=this.expandMacro(e);return t?t.map((e=>e.text)).join(""):t}_getExpansion(e){const t=this.macros.get(e);if(null==t)return t;const r="function"==typeof t?t(this):t;if("string"==typeof r){let e=0;if(-1!==r.indexOf("#")){const t=r.replace(/##/g,"");for(;-1!==t.indexOf("#"+(e+1));)++e}const t=new qt(r,this.settings),n=[];let o=t.lex();for(;"EOF"!==o.text;)n.push(o),o=t.lex();n.reverse();return{tokens:n,numArgs:e}}return r}isDefined(e){return this.macros.has(e)||Object.prototype.hasOwnProperty.call(xt,e)||Object.prototype.hasOwnProperty.call(E.math,e)||Object.prototype.hasOwnProperty.call(E.text,e)||Object.prototype.hasOwnProperty.call(Lt,e)}isExpandable(e){const t=this.macros.get(e);return null!=t?"string"==typeof t||"function"==typeof t||!t.unexpandable:Object.prototype.hasOwnProperty.call(xt,e)&&!xt[e].primitive}}const Ft=[];[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}].forEach((e=>e.blocks.forEach((e=>Ft.push(...e)))));var Gt={"́":{text:"\\'",math:"\\acute"},"̀":{text:"\\`",math:"\\grave"},"̈":{text:'\\"',math:"\\ddot"},"̃":{text:"\\~",math:"\\tilde"},"̄":{text:"\\=",math:"\\bar"},"̆":{text:"\\u",math:"\\breve"},"̌":{text:"\\v",math:"\\check"},"̂":{text:"\\^",math:"\\hat"},"̇":{text:"\\.",math:"\\dot"},"̊":{text:"\\r",math:"\\mathring"},"̋":{text:"\\H"}},Ut={"á":"á","à":"à","ä":"ä","ǟ":"ǟ","ã":"ã","ā":"ā","ă":"ă","ắ":"ắ","ằ":"ằ","ẵ":"ẵ","ǎ":"ǎ","â":"â","ấ":"ấ","ầ":"ầ","ẫ":"ẫ","ȧ":"ȧ","ǡ":"ǡ","å":"å","ǻ":"ǻ","ḃ":"ḃ","ć":"ć","č":"č","ĉ":"ĉ","ċ":"ċ","ď":"ď","ḋ":"ḋ","é":"é","è":"è","ë":"ë","ẽ":"ẽ","ē":"ē","ḗ":"ḗ","ḕ":"ḕ","ĕ":"ĕ","ě":"ě","ê":"ê","ế":"ế","ề":"ề","ễ":"ễ","ė":"ė","ḟ":"ḟ","ǵ":"ǵ","ḡ":"ḡ","ğ":"ğ","ǧ":"ǧ","ĝ":"ĝ","ġ":"ġ","ḧ":"ḧ","ȟ":"ȟ","ĥ":"ĥ","ḣ":"ḣ","í":"í","ì":"ì","ï":"ï","ḯ":"ḯ","ĩ":"ĩ","ī":"ī","ĭ":"ĭ","ǐ":"ǐ","î":"î","ǰ":"ǰ","ĵ":"ĵ","ḱ":"ḱ","ǩ":"ǩ","ĺ":"ĺ","ľ":"ľ","ḿ":"ḿ","ṁ":"ṁ","ń":"ń","ǹ":"ǹ","ñ":"ñ","ň":"ň","ṅ":"ṅ","ó":"ó","ò":"ò","ö":"ö","ȫ":"ȫ","õ":"õ","ṍ":"ṍ","ṏ":"ṏ","ȭ":"ȭ","ō":"ō","ṓ":"ṓ","ṑ":"ṑ","ŏ":"ŏ","ǒ":"ǒ","ô":"ô","ố":"ố","ồ":"ồ","ỗ":"ỗ","ȯ":"ȯ","ȱ":"ȱ","ő":"ő","ṕ":"ṕ","ṗ":"ṗ","ŕ":"ŕ","ř":"ř","ṙ":"ṙ","ś":"ś","ṥ":"ṥ","š":"š","ṧ":"ṧ","ŝ":"ŝ","ṡ":"ṡ","ẗ":"ẗ","ť":"ť","ṫ":"ṫ","ú":"ú","ù":"ù","ü":"ü","ǘ":"ǘ","ǜ":"ǜ","ǖ":"ǖ","ǚ":"ǚ","ũ":"ũ","ṹ":"ṹ","ū":"ū","ṻ":"ṻ","ŭ":"ŭ","ǔ":"ǔ","û":"û","ů":"ů","ű":"ű","ṽ":"ṽ","ẃ":"ẃ","ẁ":"ẁ","ẅ":"ẅ","ŵ":"ŵ","ẇ":"ẇ","ẘ":"ẘ","ẍ":"ẍ","ẋ":"ẋ","ý":"ý","ỳ":"ỳ","ÿ":"ÿ","ỹ":"ỹ","ȳ":"ȳ","ŷ":"ŷ","ẏ":"ẏ","ẙ":"ẙ","ź":"ź","ž":"ž","ẑ":"ẑ","ż":"ż","Á":"Á","À":"À","Ä":"Ä","Ǟ":"Ǟ","Ã":"Ã","Ā":"Ā","Ă":"Ă","Ắ":"Ắ","Ằ":"Ằ","Ẵ":"Ẵ","Ǎ":"Ǎ","Â":"Â","Ấ":"Ấ","Ầ":"Ầ","Ẫ":"Ẫ","Ȧ":"Ȧ","Ǡ":"Ǡ","Å":"Å","Ǻ":"Ǻ","Ḃ":"Ḃ","Ć":"Ć","Č":"Č","Ĉ":"Ĉ","Ċ":"Ċ","Ď":"Ď","Ḋ":"Ḋ","É":"É","È":"È","Ë":"Ë","Ẽ":"Ẽ","Ē":"Ē","Ḗ":"Ḗ","Ḕ":"Ḕ","Ĕ":"Ĕ","Ě":"Ě","Ê":"Ê","Ế":"Ế","Ề":"Ề","Ễ":"Ễ","Ė":"Ė","Ḟ":"Ḟ","Ǵ":"Ǵ","Ḡ":"Ḡ","Ğ":"Ğ","Ǧ":"Ǧ","Ĝ":"Ĝ","Ġ":"Ġ","Ḧ":"Ḧ","Ȟ":"Ȟ","Ĥ":"Ĥ","Ḣ":"Ḣ","Í":"Í","Ì":"Ì","Ï":"Ï","Ḯ":"Ḯ","Ĩ":"Ĩ","Ī":"Ī","Ĭ":"Ĭ","Ǐ":"Ǐ","Î":"Î","İ":"İ","Ĵ":"Ĵ","Ḱ":"Ḱ","Ǩ":"Ǩ","Ĺ":"Ĺ","Ľ":"Ľ","Ḿ":"Ḿ","Ṁ":"Ṁ","Ń":"Ń","Ǹ":"Ǹ","Ñ":"Ñ","Ň":"Ň","Ṅ":"Ṅ","Ó":"Ó","Ò":"Ò","Ö":"Ö","Ȫ":"Ȫ","Õ":"Õ","Ṍ":"Ṍ","Ṏ":"Ṏ","Ȭ":"Ȭ","Ō":"Ō","Ṓ":"Ṓ","Ṑ":"Ṑ","Ŏ":"Ŏ","Ǒ":"Ǒ","Ô":"Ô","Ố":"Ố","Ồ":"Ồ","Ỗ":"Ỗ","Ȯ":"Ȯ","Ȱ":"Ȱ","Ő":"Ő","Ṕ":"Ṕ","Ṗ":"Ṗ","Ŕ":"Ŕ","Ř":"Ř","Ṙ":"Ṙ","Ś":"Ś","Ṥ":"Ṥ","Š":"Š","Ṧ":"Ṧ","Ŝ":"Ŝ","Ṡ":"Ṡ","Ť":"Ť","Ṫ":"Ṫ","Ú":"Ú","Ù":"Ù","Ü":"Ü","Ǘ":"Ǘ","Ǜ":"Ǜ","Ǖ":"Ǖ","Ǚ":"Ǚ","Ũ":"Ũ","Ṹ":"Ṹ","Ū":"Ū","Ṻ":"Ṻ","Ŭ":"Ŭ","Ǔ":"Ǔ","Û":"Û","Ů":"Ů","Ű":"Ű","Ṽ":"Ṽ","Ẃ":"Ẃ","Ẁ":"Ẁ","Ẅ":"Ẅ","Ŵ":"Ŵ","Ẇ":"Ẇ","Ẍ":"Ẍ","Ẋ":"Ẋ","Ý":"Ý","Ỳ":"Ỳ","Ÿ":"Ÿ","Ỹ":"Ỹ","Ȳ":"Ȳ","Ŷ":"Ŷ","Ẏ":"Ẏ","Ź":"Ź","Ž":"Ž","Ẑ":"Ẑ","Ż":"Ż","ά":"ά","ὰ":"ὰ","ᾱ":"ᾱ","ᾰ":"ᾰ","έ":"έ","ὲ":"ὲ","ή":"ή","ὴ":"ὴ","ί":"ί","ὶ":"ὶ","ϊ":"ϊ","ΐ":"ΐ","ῒ":"ῒ","ῑ":"ῑ","ῐ":"ῐ","ό":"ό","ὸ":"ὸ","ύ":"ύ","ὺ":"ὺ","ϋ":"ϋ","ΰ":"ΰ","ῢ":"ῢ","ῡ":"ῡ","ῠ":"ῠ","ώ":"ώ","ὼ":"ὼ","Ύ":"Ύ","Ὺ":"Ὺ","Ϋ":"Ϋ","Ῡ":"Ῡ","Ῠ":"Ῠ","Ώ":"Ώ","Ὼ":"Ὼ"};const Pt=/^\d[\d.]*$/;class jt{constructor(e,t){this.mode="math",this.gullet=new Dt(e,t,this.mode),this.settings=t,this.leftrightDepth=0,this.prevAtomType=""}expect(t,r=!0){if(this.fetch().text!==t)throw new e(`Expected '${t}', got '${this.fetch().text}'`,this.fetch());r&&this.consume()}consume(){this.nextToken=null}fetch(){return null==this.nextToken&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(e){this.mode=e,this.gullet.switchMode(e)}parse(){this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");const e=this.parseExpression(!1);return this.expect("EOF"),this.gullet.endGroup(),e}static get endOfExpression(){return["}","\\endgroup","\\end","\\right","\\endtoggle","&"]}parseExpression(e,t){const r=[];for(;;){"math"===this.mode&&this.consumeSpaces();const n=this.fetch();if(-1!==jt.endOfExpression.indexOf(n.text))break;if(t&&n.text===t)break;if(e&&xt[n.text]&&xt[n.text].infix)break;const o=this.parseAtom(t);if(!o)break;"internal"!==o.type&&(r.push(o),this.prevAtomType="atom"===o.type?o.family:o.type)}return"text"===this.mode&&this.formLigatures(r),this.handleInfixNodes(r)}handleInfixNodes(t){let r,n=-1;for(let o=0;o<t.length;o++)if("infix"===t[o].type){if(-1!==n)throw new e("only one infix operator per group",t[o].token);n=o,r=t[o].replaceWith}if(-1!==n&&r){let e,o;const s=t.slice(0,n),a=t.slice(n+1);let i;return e=1===s.length&&"ordgroup"===s[0].type?s[0]:{type:"ordgroup",mode:this.mode,body:s},o=1===a.length&&"ordgroup"===a[0].type?a[0]:{type:"ordgroup",mode:this.mode,body:a},i="\\\\abovefrac"===r?this.callFunction(r,[e,t[n],o],[]):this.callFunction(r,[e,o],[]),[i]}return t}handleSupSubscript(t){const r=this.fetch(),n=r.text;this.consume(),this.consumeSpaces();const o=this.parseGroup(t);if(!o)throw new e("Expected group after '"+n+"'",r);return o}formatUnsupportedCmd(e){const t=[];for(let r=0;r<e.length;r++)t.push({type:"textord",mode:"text",text:e[r]});const r={type:"text",mode:this.mode,body:t};return{type:"color",mode:this.mode,color:this.settings.errorColor,body:[r]}}parseAtom(t){const r=this.parseGroup("atom",t);if("text"===this.mode)return r;let n,o;for(;;){this.consumeSpaces();const t=this.fetch();if("\\limits"===t.text||"\\nolimits"===t.text){if(r&&"op"===r.type){const e="\\limits"===t.text;r.limits=e,r.alwaysHandleSupSub=!0}else{if(!r||"operatorname"!==r.type||!r.alwaysHandleSupSub)throw new e("Limit controls must follow a math operator",t);{const e="\\limits"===t.text;r.limits=e}}this.consume()}else if("^"===t.text){if(n)throw new e("Double superscript",t);n=this.handleSupSubscript("superscript")}else if("_"===t.text){if(o)throw new e("Double subscript",t);o=this.handleSupSubscript("subscript")}else{if("'"!==t.text)break;{if(n)throw new e("Double superscript",t);const r={type:"textord",mode:this.mode,text:"\\prime"},o=[r];for(this.consume();"'"===this.fetch().text;)o.push(r),this.consume();"^"===this.fetch().text&&o.push(this.handleSupSubscript("superscript")),n={type:"ordgroup",mode:this.mode,body:o}}}}return n||o?r&&"multiscript"===r.type&&!r.postscripts?(r.postscripts={sup:n,sub:o},r):{type:"supsub",mode:this.mode,base:r,sup:n,sub:o}:r}parseFunction(t,r){const n=this.fetch(),o=n.text,s=xt[o];if(!s)return null;if(this.consume(),r&&"atom"!==r&&!s.allowedInArgument)throw new e("Got function '"+o+"' with no arguments"+(r?" as "+r:""),n);if("text"===this.mode&&!s.allowedInText)throw new e("Can't use function '"+o+"' in text mode",n);if("math"===this.mode&&!1===s.allowedInMath)throw new e("Can't use function '"+o+"' in math mode",n);const a=this.prevAtomType,{args:i,optArgs:l}=this.parseArguments(o,s);return this.prevAtomType=a,this.callFunction(o,i,l,n,t)}callFunction(t,r,n,o,s){const a={funcName:t,parser:this,token:o,breakOnTokenText:s},i=xt[t];if(i&&i.handler)return i.handler(a,r,n);throw new e(`No function handler for ${t}`)}parseArguments(t,r){const n=r.numArgs+r.numOptionalArgs;if(0===n)return{args:[],optArgs:[]};const o=[],s=[];for(let a=0;a<n;a++){let n=r.argTypes&&r.argTypes[a];const i=a<r.numOptionalArgs;(r.primitive&&null==n||"sqrt"===r.type&&1===a&&null==s[0])&&(n="primitive");const l=this.parseGroupOfType(`argument to '${t}'`,n,i);if(i)s.push(l);else{if(null==l)throw new e("Null argument, please report this as a bug");o.push(l)}}return{args:o,optArgs:s}}parseGroupOfType(t,r,n){switch(r){case"color":return this.parseColorGroup(n);case"size":return this.parseSizeGroup(n);case"url":return this.parseUrlGroup(n);case"math":case"text":return this.parseArgumentGroup(n,r);case"hbox":{const e=this.parseArgumentGroup(n,"text");return null!=e?{type:"styling",mode:e.mode,body:[e],scriptLevel:"text"}:null}case"raw":{const e=this.parseStringGroup("raw",n);return null!=e?{type:"raw",mode:"text",string:e.text}:null}case"primitive":{if(n)throw new e("A primitive argument cannot be optional");const r=this.parseGroup(t);if(null==r)throw new e("Expected group as "+t,this.fetch());return r}case"original":case null:case void 0:return this.parseArgumentGroup(n);default:throw new e("Unknown group type as "+t,this.fetch())}}consumeSpaces(){for(;" "===this.fetch().text;)this.consume()}parseStringGroup(e,t){const r=this.gullet.scanArgument(t);if(null==r)return null;let n,o="";for(;"EOF"!==(n=this.fetch()).text;)o+=n.text,this.consume();return this.consume(),r.text=o,r}parseRegexGroup(t,r){const n=this.fetch();let o,s=n,a="";for(;"EOF"!==(o=this.fetch()).text&&t.test(a+o.text);)s=o,a+=s.text,this.consume();if(""===a)throw new e("Invalid "+r+": '"+n.text+"'",n);return n.range(s,a)}parseColorGroup(t){const r=this.parseStringGroup("color",t);if(null==r)return null;const n=/^(#[a-f0-9]{3}|#?[a-f0-9]{6}|[a-z]+)$/i.exec(r.text);if(!n)throw new e("Invalid color: '"+r.text+"'",r);let o=n[0];return/^[0-9a-f]{6}$/i.test(o)&&(o="#"+o),{type:"color-token",mode:this.mode,color:o}}parseSizeGroup(t){let r,n=!1;if(this.gullet.consumeSpaces(),r=t||"{"===this.gullet.future().text?this.parseStringGroup("size",t):this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size"),!r)return null;t||0!==r.text.length||(r.text="0pt",n=!0);const o=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(r.text);if(!o)throw new e("Invalid size: '"+r.text+"'",r);const s={number:+(o[1]+o[2]),unit:o[3]};if(!fe(s))throw new e("Invalid unit: '"+s.unit+"'",r);return{type:"size",mode:this.mode,value:s,isBlank:n}}parseUrlGroup(e){this.gullet.lexer.setCatcode("%",13);const t=this.parseStringGroup("url",e);if(this.gullet.lexer.setCatcode("%",14),null==t)return null;const r=t.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:r}}parseArgumentGroup(e,t){const r=this.gullet.scanArgument(e);if(null==r)return null;const n=this.mode;t&&this.switchMode(t),this.gullet.beginGroup();const o=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();const s={type:"ordgroup",mode:this.mode,loc:r.loc,body:o};return t&&this.switchMode(n),s}parseGroup(e,t){const r=this.fetch(),n=r.text;let o;if("{"===n||"\\begingroup"===n||"\\toggle"===n){this.consume();const e="{"===n?"}":"\\begingroup"===n?"\\endgroup":"\\endtoggle";this.gullet.beginGroup();const t=this.parseExpression(!1,e),s=this.fetch();this.expect(e),this.gullet.endGroup(),o={type:"\\endtoggle"===s.text?"toggle":"ordgroup",mode:this.mode,loc:kt.range(r,s),body:t,semisimple:"\\begingroup"===n||void 0}}else o=this.parseFunction(t,e)||this.parseSymbol(),null!=o||"\\"!==n[0]||Object.prototype.hasOwnProperty.call(Lt,n)||(o=this.formatUnsupportedCmd(n),this.consume());return o}formLigatures(e){let t=e.length-1;for(let r=0;r<t;++r){const n=e[r],o=n.text;"-"===o&&"-"===e[r+1].text&&(r+1<t&&"-"===e[r+2].text?(e.splice(r,3,{type:"textord",mode:"text",loc:kt.range(n,e[r+2]),text:"---"}),t-=2):(e.splice(r,2,{type:"textord",mode:"text",loc:kt.range(n,e[r+1]),text:"--"}),t-=1)),"'"!==o&&"`"!==o||e[r+1].text!==o||(e.splice(r,2,{type:"textord",mode:"text",loc:kt.range(n,e[r+1]),text:o+o}),t-=1)}}parseSymbol(){const t=this.fetch();let r=t.text;if(/^\\verb[^a-zA-Z]/.test(r)){this.consume();let t=r.slice(5);const n="*"===t.charAt(0);if(n&&(t=t.slice(1)),t.length<2||t.charAt(0)!==t.slice(-1))throw new e("\\verb assertion failed --\n                    please report what input caused this bug");return t=t.slice(1,-1),{type:"verb",mode:"text",body:t,star:n}}Object.prototype.hasOwnProperty.call(Ut,r[0])&&!E[this.mode][r[0]]&&(this.settings.strict&&"math"===this.mode&&this.settings.reportNonstrict("unicodeTextInMathMode",`Accented Unicode text character "${r[0]}" used in math mode`,t),r=Ut[r[0]]+r.substr(1));const n=Nt.exec(r);let o;if(n&&(r=r.substring(0,n.index),"i"===r?r="ı":"j"===r&&(r="ȷ")),E[this.mode][r]){const e=E[this.mode][r].group,n=kt.range(t);let s;if(Object.prototype.hasOwnProperty.call(O,e)){const t=e;s={type:"atom",mode:this.mode,family:t,loc:n,text:r}}else s={type:e,mode:this.mode,loc:n,text:r};o=s}else{if(!this.strict&&Pt.test(r))return this.consume(),{type:"textord",mode:"math",loc:kt.range(t),text:r};if(!(r.charCodeAt(0)>=128))return null;this.settings.strict&&(!function(e){for(let t=0;t<Ft.length;t+=2)if(e>=Ft[t]&&e<=Ft[t+1])return!0;return!1}(r.charCodeAt(0))?this.settings.reportNonstrict("unknownSymbol",`Unrecognized Unicode character "${r[0]}" (${r.charCodeAt(0)})`,t):"math"===this.mode&&this.settings.reportNonstrict("unicodeTextInMathMode",`Unicode text character "${r[0]}" used in math mode`,t)),o={type:"textord",mode:"text",loc:kt.range(t),text:r}}if(this.consume(),n)for(let r=0;r<n[0].length;r++){const s=n[0][r];if(!Gt[s])throw new e(`Unknown accent ' ${s}'`,t);const a=Gt[s][this.mode];if(!a)throw new e(`Accent ${s} unsupported in ${this.mode} mode`,t);o={type:"accent",mode:this.mode,loc:kt.range(t),label:a,isStretchy:!1,isShifty:!0,base:o}}return o}}const Rt=function(t,r){if(!("string"==typeof t||t instanceof String))throw new TypeError("Temml can only parse string typed expression");const n=new jt(t,r);delete n.gullet.macros.current["\\df@tag"];let o=n.parse();if(delete n.gullet.macros.current["\\current@color"],delete n.gullet.macros.current["\\color"],!(o.length>0&&o[0].type&&"array"===o[0].type&&o[0].addEqnNum)&&n.gullet.macros.get("\\df@tag")){if(!r.displayMode)throw new e("\\tag works only in display equations");n.gullet.feed("\\df@tag"),o=[{type:"tag",mode:"text",body:o,tag:n.parse()}]}return o};class _t{constructor(e){this.level=e.level,this.color=e.color,this.font=e.font||"",this.fontFamily=e.fontFamily||"",this.fontWeight=e.fontWeight||"",this.fontShape=e.fontShape||"",this.maxSize=e.maxSize}extend(e){const t={level:this.level,color:this.color,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return new _t(t)}withLevel(e){return this.extend({level:e})}incrementLevel(){return this.extend({level:Math.min(this.level+1,3)})}withColor(e){return this.extend({color:e})}withFont(e){return this.extend({font:e})}withTextFontFamily(e){return this.extend({fontFamily:e,font:""})}withTextFontWeight(e){return this.extend({fontWeight:e,font:""})}withTextFontShape(e){return this.extend({fontShape:e,font:""})}getColor(){return this.color}}let Vt=function(e,t,r){t.textContent="";const n=Wt(e,r).toNode();t.appendChild(n)};"undefined"!=typeof document&&"CSS1Compat"!==document.compatMode&&("undefined"!=typeof console&&console.warn("Warning: Temml doesn't work in quirks mode. Make sure your website has a suitable doctype."),Vt=function(){throw new e("Temml doesn't work in quirks mode.")});const Wt=function(t,r){const n=new a(r);try{const e=Rt(t,n);return oe(e,t,new _t({level:n.displayMode?Be:Oe,maxSize:n.maxSize}),n)}catch(r){return function(t,r,n){if(n.throwOnError||!(t instanceof e))throw t;const o=new y(["temml-error"],[new w(r)]);return o.setAttribute("title",t.toString()),o.setAttribute("style",`color:${n.errorColor}`),o}(r,t,n)}};return{version:"0.1.3",render:Vt,renderToString:function(e,t){return Wt(e,t).toMarkup()},postProcess:function(e){const t={};let r=0;const n=e.getElementsByClassName("tml-tageqn");for(const e of n){const n=e.getElementsByClassName("tml-eqn");n.length>0&&(r+=1,n[0].id="tml-eqn-"+r);const o=e.getElementsByClassName("tml-label");if(0!==o.length)if(n.length>0)t[o[0].id]=String(r);else{const r=e.getElementsByClassName("tml-tag");r.length>0&&(t[o[0].id]=r[0].textContent)}}[...e.getElementsByClassName("tml-ref")].forEach((e=>{let r=t[e.getAttribute("href").slice(1)];-1===e.className.indexOf("tml-eqref")&&(r=r.replace(/^\(/,""),r=r.replace(/\($/,"")),"("!==r.charAt(0)&&(r="("+r),")"!==r.slice(-1)&&(r+=")"),e.textContent=r}))},ParseError:e,__parse:function(e,t){const r=new a(t);return Rt(e,r)},__renderToMathMLTree:Wt,__defineSymbol:I,__defineMacro:Bt}}();